
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://synalinks.github.io/synalinks/Synalinks%20API/Programs%20API/Program%20training%20API/">
      
      
        <link rel="prev" href="../The%20Sequential%20class/">
      
      
        <link rel="next" href="../Program%20Saving%20API/Program%20saving%20and%20loading/">
      
      
      <link rel="icon" href="../../../assets/synalinks_favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Program training API - Synalinks</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#synalinks.src.trainers.trainer.Trainer" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Synalinks" class="md-header__button md-logo" aria-label="Synalinks" data-md-component="logo">
      
  <img src="../../../assets/synalinks_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Synalinks
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Program training API
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/SynaLinks/synalinks" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    SynaLinks/synalinks
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Synalinks" class="md-nav__button md-logo" aria-label="Synalinks" data-md-component="logo">
      
  <img src="../../../assets/synalinks_logo.png" alt="logo">

    </a>
    Synalinks
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/SynaLinks/synalinks" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    SynaLinks/synalinks
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../FAQ/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Code Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Code Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Basics
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Basics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Code%20Examples/Basics/First%20Steps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    First Steps
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Code%20Examples/Basics/First%20Programs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    First Programs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Code%20Examples/Basics/Control%20Flow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Control Flow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Code%20Examples/Basics/Conversational%20Applications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Conversational Applications
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Code%20Examples/Basics/Reward%20Metrics%20And%20Optimizers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Rewards, Metrics &amp; Optimizers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Code%20Examples/Basics/Training%20Programs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Training Programs
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Advanced
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Advanced
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Code%20Examples/Advanced/Implementing%20Custom%20Modules%20And%20Programs%20Via%20Subclassing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implementing custom modules &amp; programs via subclassing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Code%20Examples/Advanced/First%20Knowledge%20Graph%20Schema/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    First Knowledge Graph Schema
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Code%20Examples/Advanced/Knowledge%20Extraction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Knowledge Extraction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Code%20Examples/Advanced/Retrieval%20Augmented%20Generation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Retrieval Augmented Generation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Synalinks API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Synalinks API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Language%20Models%20API/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Language Models API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Embedding%20Models%20API/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Embedding Models API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Knowledge%20Bases%20API/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Knowledge Bases API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Data Models API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Data Models API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Data%20Models%20API/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Data Models API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Data%20Models%20API/The%20DataModel%20class/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The DataModel class
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Data%20Models%20API/The%20JsonDataModel%20class/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The JsonDataModel class
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Data%20Models%20API/The%20SymbolicDataModel%20class/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The SymbolicDataModel class
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Data%20Models%20API/The%20Variable%20class/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The Variable class
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Data%20Models%20API/The%20Base%20DataModels/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The Base DataModels
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Programs API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Programs API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Programs API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../The%20Program%20class/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The Program class
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../The%20Sequential%20class/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    The Sequential class
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Program training API
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Program training API
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#synalinks.src.trainers.trainer.Trainer" class="md-nav__link">
    <span class="md-ellipsis">
      Trainer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synalinks.src.trainers.trainer.Trainer.compile" class="md-nav__link">
    <span class="md-ellipsis">
      compile
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synalinks.src.trainers.trainer.Trainer.compile_from_config" class="md-nav__link">
    <span class="md-ellipsis">
      compile_from_config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synalinks.src.trainers.trainer.Trainer.compute_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      compute_metrics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synalinks.src.trainers.trainer.Trainer.compute_reward" class="md-nav__link">
    <span class="md-ellipsis">
      compute_reward
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synalinks.src.trainers.trainer.Trainer.evaluate" class="md-nav__link">
    <span class="md-ellipsis">
      evaluate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synalinks.src.trainers.trainer.Trainer.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synalinks.src.trainers.trainer.Trainer.get_compile_config" class="md-nav__link">
    <span class="md-ellipsis">
      get_compile_config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synalinks.src.trainers.trainer.Trainer.get_metrics_result" class="md-nav__link">
    <span class="md-ellipsis">
      get_metrics_result
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synalinks.src.trainers.trainer.Trainer.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synalinks.src.trainers.trainer.Trainer.predict_on_batch" class="md-nav__link">
    <span class="md-ellipsis">
      predict_on_batch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synalinks.src.trainers.trainer.Trainer.test_on_batch" class="md-nav__link">
    <span class="md-ellipsis">
      test_on_batch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synalinks.src.trainers.trainer.Trainer.train_on_batch" class="md-nav__link">
    <span class="md-ellipsis">
      train_on_batch
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5_5" id="__nav_5_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Program Saving API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5_5">
            <span class="md-nav__icon md-icon"></span>
            Program Saving API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Program%20Saving%20API/Program%20saving%20and%20loading/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Program saving and loading
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Program%20Saving%20API/Variable%20saving%20and%20loading/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Variable saving and loading
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Modules API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            Modules API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Modules%20API/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modules API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Modules%20API/Base%20Module%20class/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Base Module class
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6_3" >
        
          
          <label class="md-nav__link" for="__nav_5_6_3" id="__nav_5_6_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Core Modules
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6_3">
            <span class="md-nav__icon md-icon"></span>
            Core Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Modules%20API/Core%20Modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Core Modules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Modules%20API/Core%20Modules/Input%20module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Input module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Modules%20API/Core%20Modules/Identity%20module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Identity module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Modules%20API/Core%20Modules/Not%20module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Not module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Modules%20API/Core%20Modules/Generator%20module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generator module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Modules%20API/Core%20Modules/Decision%20module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Decision module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Modules%20API/Core%20Modules/Action%20module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Action module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Modules%20API/Core%20Modules/Branch%20module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Branch module
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6_4" >
        
          
          <label class="md-nav__link" for="__nav_5_6_4" id="__nav_5_6_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Knowledge Modules
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6_4">
            <span class="md-nav__icon md-icon"></span>
            Knowledge Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Modules%20API/Knowledge%20Modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Knowledge Modules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Modules%20API/Knowledge%20Modules/Embedding%20module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Embedding module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Modules%20API/Knowledge%20Modules/UpdateKnowledge%20module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UpdateKnowledge module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Modules%20API/Knowledge%20Modules/EntityRetriever%20module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EntityRetriever module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Modules%20API/Knowledge%20Modules/KnowledgeRetriever%20module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    KnowledgeRetriever module
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6_5" >
        
          
          <label class="md-nav__link" for="__nav_5_6_5" id="__nav_5_6_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Merging Modules
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_6_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6_5">
            <span class="md-nav__icon md-icon"></span>
            Merging Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Modules%20API/Merging%20Modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Merging Modules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Modules%20API/Merging%20Modules/Concat%20module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Concat module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Modules%20API/Merging%20Modules/And%20module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    And module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Modules%20API/Merging%20Modules/Or%20module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Or module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Modules%20API/Merging%20Modules/Xor%20module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Xor module
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6_6" id="__nav_5_6_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Test Time Compute Modules
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_6_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6_6">
            <span class="md-nav__icon md-icon"></span>
            Test Time Compute Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Modules%20API/Test%20Time%20Compute%20Modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Test Time Compute Modules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Modules%20API/Test%20Time%20Compute%20Modules/ChainOfThought%20module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ChainOfThought module
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Modules%20API/Test%20Time%20Compute%20Modules/SelfCritique%20module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SelfCritique module
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6_7" >
        
          
          <label class="md-nav__link" for="__nav_5_6_7" id="__nav_5_6_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Agents Modules
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_6_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6_7">
            <span class="md-nav__icon md-icon"></span>
            Agents Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Modules%20API/Agents%20Modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agent Modules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Modules%20API/Agents%20Modules/ReACT%20Agent%20module/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ReACT Agent module
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_7" >
        
          
          <label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Callbacks API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            Callbacks API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Callbacks%20API/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Callbacks API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Callbacks%20API/Base%20Callback%20class/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Base Callback class
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Callbacks%20API/ProgramCheckpoint/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ProgramCheckpoint
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Callbacks%20API/CSVLogger/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CSVLogger
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_8" >
        
          
          <label class="md-nav__link" for="__nav_5_8" id="__nav_5_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Ops API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_8">
            <span class="md-nav__icon md-icon"></span>
            Ops API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ops%20API/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ops API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ops%20API/JSON%20Ops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    JSON Ops
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ops%20API/Language%20Models%20Ops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Language Models Ops
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Ops%20API/Embedding%20Models%20Ops/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Embedding Models Ops
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_9" >
        
          
          <label class="md-nav__link" for="__nav_5_9" id="__nav_5_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Optimizers API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_9">
            <span class="md-nav__icon md-icon"></span>
            Optimizers API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Optimizers%20API/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Optimizers API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Optimizers%20API/Base%20Optimizer%20class/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Base Optimizer class
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Optimizers%20API/RandomFewShot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RandomFewShot
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Optimizers%20API/OPRO/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OPRO
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Optimizers%20API/FewShotOPRO/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FewShotOPRO
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_10" >
        
          
          <label class="md-nav__link" for="__nav_5_10" id="__nav_5_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Metrics
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_10">
            <span class="md-nav__icon md-icon"></span>
            Metrics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metrics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Metrics/Base%20Metric%20class/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Base Metric class
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Metrics/Metric%20wrappers%20and%20reduction%20metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metric wrappers and reduction metrics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Metrics/Regression%20metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Regression metrics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Metrics/FScore%20metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FScore metrics
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_11" >
        
          
          <label class="md-nav__link" for="__nav_5_11" id="__nav_5_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Rewards
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_11">
            <span class="md-nav__icon md-icon"></span>
            Rewards
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Rewards/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Rewards
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Rewards/ExactMatch%20reward/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ExactMatch reward
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Rewards/CosineSimilarity%20reward/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CosineSimilarity reward
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Rewards/LMAsJudge%20reward/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LMAsJudge reward
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Rewards/Reward%20wrappers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reward wrappers
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_12" >
        
          
          <label class="md-nav__link" for="__nav_5_12" id="__nav_5_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Built-in Datasets
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_12">
            <span class="md-nav__icon md-icon"></span>
            Built-in Datasets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Built-in%20Datasets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Built-in Datasets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Built-in%20Datasets/GSM8K/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GSM8K
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Built-in%20Datasets/HotpotQA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HotpotQA
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Built-in%20Datasets/ARC-AGI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ARC AGI
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_13" >
        
          
          <label class="md-nav__link" for="__nav_5_13" id="__nav_5_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Utilities
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_13">
            <span class="md-nav__icon md-icon"></span>
            Utilities
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Utilities/Program%20plotting%20utilities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Program plotting utilities
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Utilities/More%20plotting%20utilities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    More plotting utilities
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Utilities/NLP%20utilities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    NLP utilities
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Config
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Deployment
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Deployment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Deployment/Building%20a%20REST%20API/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Building a REST API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Deployment/Enabling%20LM%20Tracing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Enabling LM Tracing with Arize Phoenix
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#synalinks.src.trainers.trainer.Trainer" class="md-nav__link">
    <span class="md-ellipsis">
      Trainer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synalinks.src.trainers.trainer.Trainer.compile" class="md-nav__link">
    <span class="md-ellipsis">
      compile
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synalinks.src.trainers.trainer.Trainer.compile_from_config" class="md-nav__link">
    <span class="md-ellipsis">
      compile_from_config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synalinks.src.trainers.trainer.Trainer.compute_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      compute_metrics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synalinks.src.trainers.trainer.Trainer.compute_reward" class="md-nav__link">
    <span class="md-ellipsis">
      compute_reward
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synalinks.src.trainers.trainer.Trainer.evaluate" class="md-nav__link">
    <span class="md-ellipsis">
      evaluate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synalinks.src.trainers.trainer.Trainer.fit" class="md-nav__link">
    <span class="md-ellipsis">
      fit
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synalinks.src.trainers.trainer.Trainer.get_compile_config" class="md-nav__link">
    <span class="md-ellipsis">
      get_compile_config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synalinks.src.trainers.trainer.Trainer.get_metrics_result" class="md-nav__link">
    <span class="md-ellipsis">
      get_metrics_result
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synalinks.src.trainers.trainer.Trainer.predict" class="md-nav__link">
    <span class="md-ellipsis">
      predict
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synalinks.src.trainers.trainer.Trainer.predict_on_batch" class="md-nav__link">
    <span class="md-ellipsis">
      predict_on_batch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synalinks.src.trainers.trainer.Trainer.test_on_batch" class="md-nav__link">
    <span class="md-ellipsis">
      test_on_batch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synalinks.src.trainers.trainer.Trainer.train_on_batch" class="md-nav__link">
    <span class="md-ellipsis">
      train_on_batch
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Program training API</h1>

<div class="doc doc-object doc-class">



<a id="synalinks.src.trainers.trainer.Trainer"></a>
    <div class="doc doc-contents first">








              <details class="quote">
                <summary>Source code in <code>synalinks/src/trainers/trainer.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-26">  26</a></span>
<span class="normal"><a href="#__codelineno-0-27">  27</a></span>
<span class="normal"><a href="#__codelineno-0-28">  28</a></span>
<span class="normal"><a href="#__codelineno-0-29">  29</a></span>
<span class="normal"><a href="#__codelineno-0-30">  30</a></span>
<span class="normal"><a href="#__codelineno-0-31">  31</a></span>
<span class="normal"><a href="#__codelineno-0-32">  32</a></span>
<span class="normal"><a href="#__codelineno-0-33">  33</a></span>
<span class="normal"><a href="#__codelineno-0-34">  34</a></span>
<span class="normal"><a href="#__codelineno-0-35">  35</a></span>
<span class="normal"><a href="#__codelineno-0-36">  36</a></span>
<span class="normal"><a href="#__codelineno-0-37">  37</a></span>
<span class="normal"><a href="#__codelineno-0-38">  38</a></span>
<span class="normal"><a href="#__codelineno-0-39">  39</a></span>
<span class="normal"><a href="#__codelineno-0-40">  40</a></span>
<span class="normal"><a href="#__codelineno-0-41">  41</a></span>
<span class="normal"><a href="#__codelineno-0-42">  42</a></span>
<span class="normal"><a href="#__codelineno-0-43">  43</a></span>
<span class="normal"><a href="#__codelineno-0-44">  44</a></span>
<span class="normal"><a href="#__codelineno-0-45">  45</a></span>
<span class="normal"><a href="#__codelineno-0-46">  46</a></span>
<span class="normal"><a href="#__codelineno-0-47">  47</a></span>
<span class="normal"><a href="#__codelineno-0-48">  48</a></span>
<span class="normal"><a href="#__codelineno-0-49">  49</a></span>
<span class="normal"><a href="#__codelineno-0-50">  50</a></span>
<span class="normal"><a href="#__codelineno-0-51">  51</a></span>
<span class="normal"><a href="#__codelineno-0-52">  52</a></span>
<span class="normal"><a href="#__codelineno-0-53">  53</a></span>
<span class="normal"><a href="#__codelineno-0-54">  54</a></span>
<span class="normal"><a href="#__codelineno-0-55">  55</a></span>
<span class="normal"><a href="#__codelineno-0-56">  56</a></span>
<span class="normal"><a href="#__codelineno-0-57">  57</a></span>
<span class="normal"><a href="#__codelineno-0-58">  58</a></span>
<span class="normal"><a href="#__codelineno-0-59">  59</a></span>
<span class="normal"><a href="#__codelineno-0-60">  60</a></span>
<span class="normal"><a href="#__codelineno-0-61">  61</a></span>
<span class="normal"><a href="#__codelineno-0-62">  62</a></span>
<span class="normal"><a href="#__codelineno-0-63">  63</a></span>
<span class="normal"><a href="#__codelineno-0-64">  64</a></span>
<span class="normal"><a href="#__codelineno-0-65">  65</a></span>
<span class="normal"><a href="#__codelineno-0-66">  66</a></span>
<span class="normal"><a href="#__codelineno-0-67">  67</a></span>
<span class="normal"><a href="#__codelineno-0-68">  68</a></span>
<span class="normal"><a href="#__codelineno-0-69">  69</a></span>
<span class="normal"><a href="#__codelineno-0-70">  70</a></span>
<span class="normal"><a href="#__codelineno-0-71">  71</a></span>
<span class="normal"><a href="#__codelineno-0-72">  72</a></span>
<span class="normal"><a href="#__codelineno-0-73">  73</a></span>
<span class="normal"><a href="#__codelineno-0-74">  74</a></span>
<span class="normal"><a href="#__codelineno-0-75">  75</a></span>
<span class="normal"><a href="#__codelineno-0-76">  76</a></span>
<span class="normal"><a href="#__codelineno-0-77">  77</a></span>
<span class="normal"><a href="#__codelineno-0-78">  78</a></span>
<span class="normal"><a href="#__codelineno-0-79">  79</a></span>
<span class="normal"><a href="#__codelineno-0-80">  80</a></span>
<span class="normal"><a href="#__codelineno-0-81">  81</a></span>
<span class="normal"><a href="#__codelineno-0-82">  82</a></span>
<span class="normal"><a href="#__codelineno-0-83">  83</a></span>
<span class="normal"><a href="#__codelineno-0-84">  84</a></span>
<span class="normal"><a href="#__codelineno-0-85">  85</a></span>
<span class="normal"><a href="#__codelineno-0-86">  86</a></span>
<span class="normal"><a href="#__codelineno-0-87">  87</a></span>
<span class="normal"><a href="#__codelineno-0-88">  88</a></span>
<span class="normal"><a href="#__codelineno-0-89">  89</a></span>
<span class="normal"><a href="#__codelineno-0-90">  90</a></span>
<span class="normal"><a href="#__codelineno-0-91">  91</a></span>
<span class="normal"><a href="#__codelineno-0-92">  92</a></span>
<span class="normal"><a href="#__codelineno-0-93">  93</a></span>
<span class="normal"><a href="#__codelineno-0-94">  94</a></span>
<span class="normal"><a href="#__codelineno-0-95">  95</a></span>
<span class="normal"><a href="#__codelineno-0-96">  96</a></span>
<span class="normal"><a href="#__codelineno-0-97">  97</a></span>
<span class="normal"><a href="#__codelineno-0-98">  98</a></span>
<span class="normal"><a href="#__codelineno-0-99">  99</a></span>
<span class="normal"><a href="#__codelineno-0-100"> 100</a></span>
<span class="normal"><a href="#__codelineno-0-101"> 101</a></span>
<span class="normal"><a href="#__codelineno-0-102"> 102</a></span>
<span class="normal"><a href="#__codelineno-0-103"> 103</a></span>
<span class="normal"><a href="#__codelineno-0-104"> 104</a></span>
<span class="normal"><a href="#__codelineno-0-105"> 105</a></span>
<span class="normal"><a href="#__codelineno-0-106"> 106</a></span>
<span class="normal"><a href="#__codelineno-0-107"> 107</a></span>
<span class="normal"><a href="#__codelineno-0-108"> 108</a></span>
<span class="normal"><a href="#__codelineno-0-109"> 109</a></span>
<span class="normal"><a href="#__codelineno-0-110"> 110</a></span>
<span class="normal"><a href="#__codelineno-0-111"> 111</a></span>
<span class="normal"><a href="#__codelineno-0-112"> 112</a></span>
<span class="normal"><a href="#__codelineno-0-113"> 113</a></span>
<span class="normal"><a href="#__codelineno-0-114"> 114</a></span>
<span class="normal"><a href="#__codelineno-0-115"> 115</a></span>
<span class="normal"><a href="#__codelineno-0-116"> 116</a></span>
<span class="normal"><a href="#__codelineno-0-117"> 117</a></span>
<span class="normal"><a href="#__codelineno-0-118"> 118</a></span>
<span class="normal"><a href="#__codelineno-0-119"> 119</a></span>
<span class="normal"><a href="#__codelineno-0-120"> 120</a></span>
<span class="normal"><a href="#__codelineno-0-121"> 121</a></span>
<span class="normal"><a href="#__codelineno-0-122"> 122</a></span>
<span class="normal"><a href="#__codelineno-0-123"> 123</a></span>
<span class="normal"><a href="#__codelineno-0-124"> 124</a></span>
<span class="normal"><a href="#__codelineno-0-125"> 125</a></span>
<span class="normal"><a href="#__codelineno-0-126"> 126</a></span>
<span class="normal"><a href="#__codelineno-0-127"> 127</a></span>
<span class="normal"><a href="#__codelineno-0-128"> 128</a></span>
<span class="normal"><a href="#__codelineno-0-129"> 129</a></span>
<span class="normal"><a href="#__codelineno-0-130"> 130</a></span>
<span class="normal"><a href="#__codelineno-0-131"> 131</a></span>
<span class="normal"><a href="#__codelineno-0-132"> 132</a></span>
<span class="normal"><a href="#__codelineno-0-133"> 133</a></span>
<span class="normal"><a href="#__codelineno-0-134"> 134</a></span>
<span class="normal"><a href="#__codelineno-0-135"> 135</a></span>
<span class="normal"><a href="#__codelineno-0-136"> 136</a></span>
<span class="normal"><a href="#__codelineno-0-137"> 137</a></span>
<span class="normal"><a href="#__codelineno-0-138"> 138</a></span>
<span class="normal"><a href="#__codelineno-0-139"> 139</a></span>
<span class="normal"><a href="#__codelineno-0-140"> 140</a></span>
<span class="normal"><a href="#__codelineno-0-141"> 141</a></span>
<span class="normal"><a href="#__codelineno-0-142"> 142</a></span>
<span class="normal"><a href="#__codelineno-0-143"> 143</a></span>
<span class="normal"><a href="#__codelineno-0-144"> 144</a></span>
<span class="normal"><a href="#__codelineno-0-145"> 145</a></span>
<span class="normal"><a href="#__codelineno-0-146"> 146</a></span>
<span class="normal"><a href="#__codelineno-0-147"> 147</a></span>
<span class="normal"><a href="#__codelineno-0-148"> 148</a></span>
<span class="normal"><a href="#__codelineno-0-149"> 149</a></span>
<span class="normal"><a href="#__codelineno-0-150"> 150</a></span>
<span class="normal"><a href="#__codelineno-0-151"> 151</a></span>
<span class="normal"><a href="#__codelineno-0-152"> 152</a></span>
<span class="normal"><a href="#__codelineno-0-153"> 153</a></span>
<span class="normal"><a href="#__codelineno-0-154"> 154</a></span>
<span class="normal"><a href="#__codelineno-0-155"> 155</a></span>
<span class="normal"><a href="#__codelineno-0-156"> 156</a></span>
<span class="normal"><a href="#__codelineno-0-157"> 157</a></span>
<span class="normal"><a href="#__codelineno-0-158"> 158</a></span>
<span class="normal"><a href="#__codelineno-0-159"> 159</a></span>
<span class="normal"><a href="#__codelineno-0-160"> 160</a></span>
<span class="normal"><a href="#__codelineno-0-161"> 161</a></span>
<span class="normal"><a href="#__codelineno-0-162"> 162</a></span>
<span class="normal"><a href="#__codelineno-0-163"> 163</a></span>
<span class="normal"><a href="#__codelineno-0-164"> 164</a></span>
<span class="normal"><a href="#__codelineno-0-165"> 165</a></span>
<span class="normal"><a href="#__codelineno-0-166"> 166</a></span>
<span class="normal"><a href="#__codelineno-0-167"> 167</a></span>
<span class="normal"><a href="#__codelineno-0-168"> 168</a></span>
<span class="normal"><a href="#__codelineno-0-169"> 169</a></span>
<span class="normal"><a href="#__codelineno-0-170"> 170</a></span>
<span class="normal"><a href="#__codelineno-0-171"> 171</a></span>
<span class="normal"><a href="#__codelineno-0-172"> 172</a></span>
<span class="normal"><a href="#__codelineno-0-173"> 173</a></span>
<span class="normal"><a href="#__codelineno-0-174"> 174</a></span>
<span class="normal"><a href="#__codelineno-0-175"> 175</a></span>
<span class="normal"><a href="#__codelineno-0-176"> 176</a></span>
<span class="normal"><a href="#__codelineno-0-177"> 177</a></span>
<span class="normal"><a href="#__codelineno-0-178"> 178</a></span>
<span class="normal"><a href="#__codelineno-0-179"> 179</a></span>
<span class="normal"><a href="#__codelineno-0-180"> 180</a></span>
<span class="normal"><a href="#__codelineno-0-181"> 181</a></span>
<span class="normal"><a href="#__codelineno-0-182"> 182</a></span>
<span class="normal"><a href="#__codelineno-0-183"> 183</a></span>
<span class="normal"><a href="#__codelineno-0-184"> 184</a></span>
<span class="normal"><a href="#__codelineno-0-185"> 185</a></span>
<span class="normal"><a href="#__codelineno-0-186"> 186</a></span>
<span class="normal"><a href="#__codelineno-0-187"> 187</a></span>
<span class="normal"><a href="#__codelineno-0-188"> 188</a></span>
<span class="normal"><a href="#__codelineno-0-189"> 189</a></span>
<span class="normal"><a href="#__codelineno-0-190"> 190</a></span>
<span class="normal"><a href="#__codelineno-0-191"> 191</a></span>
<span class="normal"><a href="#__codelineno-0-192"> 192</a></span>
<span class="normal"><a href="#__codelineno-0-193"> 193</a></span>
<span class="normal"><a href="#__codelineno-0-194"> 194</a></span>
<span class="normal"><a href="#__codelineno-0-195"> 195</a></span>
<span class="normal"><a href="#__codelineno-0-196"> 196</a></span>
<span class="normal"><a href="#__codelineno-0-197"> 197</a></span>
<span class="normal"><a href="#__codelineno-0-198"> 198</a></span>
<span class="normal"><a href="#__codelineno-0-199"> 199</a></span>
<span class="normal"><a href="#__codelineno-0-200"> 200</a></span>
<span class="normal"><a href="#__codelineno-0-201"> 201</a></span>
<span class="normal"><a href="#__codelineno-0-202"> 202</a></span>
<span class="normal"><a href="#__codelineno-0-203"> 203</a></span>
<span class="normal"><a href="#__codelineno-0-204"> 204</a></span>
<span class="normal"><a href="#__codelineno-0-205"> 205</a></span>
<span class="normal"><a href="#__codelineno-0-206"> 206</a></span>
<span class="normal"><a href="#__codelineno-0-207"> 207</a></span>
<span class="normal"><a href="#__codelineno-0-208"> 208</a></span>
<span class="normal"><a href="#__codelineno-0-209"> 209</a></span>
<span class="normal"><a href="#__codelineno-0-210"> 210</a></span>
<span class="normal"><a href="#__codelineno-0-211"> 211</a></span>
<span class="normal"><a href="#__codelineno-0-212"> 212</a></span>
<span class="normal"><a href="#__codelineno-0-213"> 213</a></span>
<span class="normal"><a href="#__codelineno-0-214"> 214</a></span>
<span class="normal"><a href="#__codelineno-0-215"> 215</a></span>
<span class="normal"><a href="#__codelineno-0-216"> 216</a></span>
<span class="normal"><a href="#__codelineno-0-217"> 217</a></span>
<span class="normal"><a href="#__codelineno-0-218"> 218</a></span>
<span class="normal"><a href="#__codelineno-0-219"> 219</a></span>
<span class="normal"><a href="#__codelineno-0-220"> 220</a></span>
<span class="normal"><a href="#__codelineno-0-221"> 221</a></span>
<span class="normal"><a href="#__codelineno-0-222"> 222</a></span>
<span class="normal"><a href="#__codelineno-0-223"> 223</a></span>
<span class="normal"><a href="#__codelineno-0-224"> 224</a></span>
<span class="normal"><a href="#__codelineno-0-225"> 225</a></span>
<span class="normal"><a href="#__codelineno-0-226"> 226</a></span>
<span class="normal"><a href="#__codelineno-0-227"> 227</a></span>
<span class="normal"><a href="#__codelineno-0-228"> 228</a></span>
<span class="normal"><a href="#__codelineno-0-229"> 229</a></span>
<span class="normal"><a href="#__codelineno-0-230"> 230</a></span>
<span class="normal"><a href="#__codelineno-0-231"> 231</a></span>
<span class="normal"><a href="#__codelineno-0-232"> 232</a></span>
<span class="normal"><a href="#__codelineno-0-233"> 233</a></span>
<span class="normal"><a href="#__codelineno-0-234"> 234</a></span>
<span class="normal"><a href="#__codelineno-0-235"> 235</a></span>
<span class="normal"><a href="#__codelineno-0-236"> 236</a></span>
<span class="normal"><a href="#__codelineno-0-237"> 237</a></span>
<span class="normal"><a href="#__codelineno-0-238"> 238</a></span>
<span class="normal"><a href="#__codelineno-0-239"> 239</a></span>
<span class="normal"><a href="#__codelineno-0-240"> 240</a></span>
<span class="normal"><a href="#__codelineno-0-241"> 241</a></span>
<span class="normal"><a href="#__codelineno-0-242"> 242</a></span>
<span class="normal"><a href="#__codelineno-0-243"> 243</a></span>
<span class="normal"><a href="#__codelineno-0-244"> 244</a></span>
<span class="normal"><a href="#__codelineno-0-245"> 245</a></span>
<span class="normal"><a href="#__codelineno-0-246"> 246</a></span>
<span class="normal"><a href="#__codelineno-0-247"> 247</a></span>
<span class="normal"><a href="#__codelineno-0-248"> 248</a></span>
<span class="normal"><a href="#__codelineno-0-249"> 249</a></span>
<span class="normal"><a href="#__codelineno-0-250"> 250</a></span>
<span class="normal"><a href="#__codelineno-0-251"> 251</a></span>
<span class="normal"><a href="#__codelineno-0-252"> 252</a></span>
<span class="normal"><a href="#__codelineno-0-253"> 253</a></span>
<span class="normal"><a href="#__codelineno-0-254"> 254</a></span>
<span class="normal"><a href="#__codelineno-0-255"> 255</a></span>
<span class="normal"><a href="#__codelineno-0-256"> 256</a></span>
<span class="normal"><a href="#__codelineno-0-257"> 257</a></span>
<span class="normal"><a href="#__codelineno-0-258"> 258</a></span>
<span class="normal"><a href="#__codelineno-0-259"> 259</a></span>
<span class="normal"><a href="#__codelineno-0-260"> 260</a></span>
<span class="normal"><a href="#__codelineno-0-261"> 261</a></span>
<span class="normal"><a href="#__codelineno-0-262"> 262</a></span>
<span class="normal"><a href="#__codelineno-0-263"> 263</a></span>
<span class="normal"><a href="#__codelineno-0-264"> 264</a></span>
<span class="normal"><a href="#__codelineno-0-265"> 265</a></span>
<span class="normal"><a href="#__codelineno-0-266"> 266</a></span>
<span class="normal"><a href="#__codelineno-0-267"> 267</a></span>
<span class="normal"><a href="#__codelineno-0-268"> 268</a></span>
<span class="normal"><a href="#__codelineno-0-269"> 269</a></span>
<span class="normal"><a href="#__codelineno-0-270"> 270</a></span>
<span class="normal"><a href="#__codelineno-0-271"> 271</a></span>
<span class="normal"><a href="#__codelineno-0-272"> 272</a></span>
<span class="normal"><a href="#__codelineno-0-273"> 273</a></span>
<span class="normal"><a href="#__codelineno-0-274"> 274</a></span>
<span class="normal"><a href="#__codelineno-0-275"> 275</a></span>
<span class="normal"><a href="#__codelineno-0-276"> 276</a></span>
<span class="normal"><a href="#__codelineno-0-277"> 277</a></span>
<span class="normal"><a href="#__codelineno-0-278"> 278</a></span>
<span class="normal"><a href="#__codelineno-0-279"> 279</a></span>
<span class="normal"><a href="#__codelineno-0-280"> 280</a></span>
<span class="normal"><a href="#__codelineno-0-281"> 281</a></span>
<span class="normal"><a href="#__codelineno-0-282"> 282</a></span>
<span class="normal"><a href="#__codelineno-0-283"> 283</a></span>
<span class="normal"><a href="#__codelineno-0-284"> 284</a></span>
<span class="normal"><a href="#__codelineno-0-285"> 285</a></span>
<span class="normal"><a href="#__codelineno-0-286"> 286</a></span>
<span class="normal"><a href="#__codelineno-0-287"> 287</a></span>
<span class="normal"><a href="#__codelineno-0-288"> 288</a></span>
<span class="normal"><a href="#__codelineno-0-289"> 289</a></span>
<span class="normal"><a href="#__codelineno-0-290"> 290</a></span>
<span class="normal"><a href="#__codelineno-0-291"> 291</a></span>
<span class="normal"><a href="#__codelineno-0-292"> 292</a></span>
<span class="normal"><a href="#__codelineno-0-293"> 293</a></span>
<span class="normal"><a href="#__codelineno-0-294"> 294</a></span>
<span class="normal"><a href="#__codelineno-0-295"> 295</a></span>
<span class="normal"><a href="#__codelineno-0-296"> 296</a></span>
<span class="normal"><a href="#__codelineno-0-297"> 297</a></span>
<span class="normal"><a href="#__codelineno-0-298"> 298</a></span>
<span class="normal"><a href="#__codelineno-0-299"> 299</a></span>
<span class="normal"><a href="#__codelineno-0-300"> 300</a></span>
<span class="normal"><a href="#__codelineno-0-301"> 301</a></span>
<span class="normal"><a href="#__codelineno-0-302"> 302</a></span>
<span class="normal"><a href="#__codelineno-0-303"> 303</a></span>
<span class="normal"><a href="#__codelineno-0-304"> 304</a></span>
<span class="normal"><a href="#__codelineno-0-305"> 305</a></span>
<span class="normal"><a href="#__codelineno-0-306"> 306</a></span>
<span class="normal"><a href="#__codelineno-0-307"> 307</a></span>
<span class="normal"><a href="#__codelineno-0-308"> 308</a></span>
<span class="normal"><a href="#__codelineno-0-309"> 309</a></span>
<span class="normal"><a href="#__codelineno-0-310"> 310</a></span>
<span class="normal"><a href="#__codelineno-0-311"> 311</a></span>
<span class="normal"><a href="#__codelineno-0-312"> 312</a></span>
<span class="normal"><a href="#__codelineno-0-313"> 313</a></span>
<span class="normal"><a href="#__codelineno-0-314"> 314</a></span>
<span class="normal"><a href="#__codelineno-0-315"> 315</a></span>
<span class="normal"><a href="#__codelineno-0-316"> 316</a></span>
<span class="normal"><a href="#__codelineno-0-317"> 317</a></span>
<span class="normal"><a href="#__codelineno-0-318"> 318</a></span>
<span class="normal"><a href="#__codelineno-0-319"> 319</a></span>
<span class="normal"><a href="#__codelineno-0-320"> 320</a></span>
<span class="normal"><a href="#__codelineno-0-321"> 321</a></span>
<span class="normal"><a href="#__codelineno-0-322"> 322</a></span>
<span class="normal"><a href="#__codelineno-0-323"> 323</a></span>
<span class="normal"><a href="#__codelineno-0-324"> 324</a></span>
<span class="normal"><a href="#__codelineno-0-325"> 325</a></span>
<span class="normal"><a href="#__codelineno-0-326"> 326</a></span>
<span class="normal"><a href="#__codelineno-0-327"> 327</a></span>
<span class="normal"><a href="#__codelineno-0-328"> 328</a></span>
<span class="normal"><a href="#__codelineno-0-329"> 329</a></span>
<span class="normal"><a href="#__codelineno-0-330"> 330</a></span>
<span class="normal"><a href="#__codelineno-0-331"> 331</a></span>
<span class="normal"><a href="#__codelineno-0-332"> 332</a></span>
<span class="normal"><a href="#__codelineno-0-333"> 333</a></span>
<span class="normal"><a href="#__codelineno-0-334"> 334</a></span>
<span class="normal"><a href="#__codelineno-0-335"> 335</a></span>
<span class="normal"><a href="#__codelineno-0-336"> 336</a></span>
<span class="normal"><a href="#__codelineno-0-337"> 337</a></span>
<span class="normal"><a href="#__codelineno-0-338"> 338</a></span>
<span class="normal"><a href="#__codelineno-0-339"> 339</a></span>
<span class="normal"><a href="#__codelineno-0-340"> 340</a></span>
<span class="normal"><a href="#__codelineno-0-341"> 341</a></span>
<span class="normal"><a href="#__codelineno-0-342"> 342</a></span>
<span class="normal"><a href="#__codelineno-0-343"> 343</a></span>
<span class="normal"><a href="#__codelineno-0-344"> 344</a></span>
<span class="normal"><a href="#__codelineno-0-345"> 345</a></span>
<span class="normal"><a href="#__codelineno-0-346"> 346</a></span>
<span class="normal"><a href="#__codelineno-0-347"> 347</a></span>
<span class="normal"><a href="#__codelineno-0-348"> 348</a></span>
<span class="normal"><a href="#__codelineno-0-349"> 349</a></span>
<span class="normal"><a href="#__codelineno-0-350"> 350</a></span>
<span class="normal"><a href="#__codelineno-0-351"> 351</a></span>
<span class="normal"><a href="#__codelineno-0-352"> 352</a></span>
<span class="normal"><a href="#__codelineno-0-353"> 353</a></span>
<span class="normal"><a href="#__codelineno-0-354"> 354</a></span>
<span class="normal"><a href="#__codelineno-0-355"> 355</a></span>
<span class="normal"><a href="#__codelineno-0-356"> 356</a></span>
<span class="normal"><a href="#__codelineno-0-357"> 357</a></span>
<span class="normal"><a href="#__codelineno-0-358"> 358</a></span>
<span class="normal"><a href="#__codelineno-0-359"> 359</a></span>
<span class="normal"><a href="#__codelineno-0-360"> 360</a></span>
<span class="normal"><a href="#__codelineno-0-361"> 361</a></span>
<span class="normal"><a href="#__codelineno-0-362"> 362</a></span>
<span class="normal"><a href="#__codelineno-0-363"> 363</a></span>
<span class="normal"><a href="#__codelineno-0-364"> 364</a></span>
<span class="normal"><a href="#__codelineno-0-365"> 365</a></span>
<span class="normal"><a href="#__codelineno-0-366"> 366</a></span>
<span class="normal"><a href="#__codelineno-0-367"> 367</a></span>
<span class="normal"><a href="#__codelineno-0-368"> 368</a></span>
<span class="normal"><a href="#__codelineno-0-369"> 369</a></span>
<span class="normal"><a href="#__codelineno-0-370"> 370</a></span>
<span class="normal"><a href="#__codelineno-0-371"> 371</a></span>
<span class="normal"><a href="#__codelineno-0-372"> 372</a></span>
<span class="normal"><a href="#__codelineno-0-373"> 373</a></span>
<span class="normal"><a href="#__codelineno-0-374"> 374</a></span>
<span class="normal"><a href="#__codelineno-0-375"> 375</a></span>
<span class="normal"><a href="#__codelineno-0-376"> 376</a></span>
<span class="normal"><a href="#__codelineno-0-377"> 377</a></span>
<span class="normal"><a href="#__codelineno-0-378"> 378</a></span>
<span class="normal"><a href="#__codelineno-0-379"> 379</a></span>
<span class="normal"><a href="#__codelineno-0-380"> 380</a></span>
<span class="normal"><a href="#__codelineno-0-381"> 381</a></span>
<span class="normal"><a href="#__codelineno-0-382"> 382</a></span>
<span class="normal"><a href="#__codelineno-0-383"> 383</a></span>
<span class="normal"><a href="#__codelineno-0-384"> 384</a></span>
<span class="normal"><a href="#__codelineno-0-385"> 385</a></span>
<span class="normal"><a href="#__codelineno-0-386"> 386</a></span>
<span class="normal"><a href="#__codelineno-0-387"> 387</a></span>
<span class="normal"><a href="#__codelineno-0-388"> 388</a></span>
<span class="normal"><a href="#__codelineno-0-389"> 389</a></span>
<span class="normal"><a href="#__codelineno-0-390"> 390</a></span>
<span class="normal"><a href="#__codelineno-0-391"> 391</a></span>
<span class="normal"><a href="#__codelineno-0-392"> 392</a></span>
<span class="normal"><a href="#__codelineno-0-393"> 393</a></span>
<span class="normal"><a href="#__codelineno-0-394"> 394</a></span>
<span class="normal"><a href="#__codelineno-0-395"> 395</a></span>
<span class="normal"><a href="#__codelineno-0-396"> 396</a></span>
<span class="normal"><a href="#__codelineno-0-397"> 397</a></span>
<span class="normal"><a href="#__codelineno-0-398"> 398</a></span>
<span class="normal"><a href="#__codelineno-0-399"> 399</a></span>
<span class="normal"><a href="#__codelineno-0-400"> 400</a></span>
<span class="normal"><a href="#__codelineno-0-401"> 401</a></span>
<span class="normal"><a href="#__codelineno-0-402"> 402</a></span>
<span class="normal"><a href="#__codelineno-0-403"> 403</a></span>
<span class="normal"><a href="#__codelineno-0-404"> 404</a></span>
<span class="normal"><a href="#__codelineno-0-405"> 405</a></span>
<span class="normal"><a href="#__codelineno-0-406"> 406</a></span>
<span class="normal"><a href="#__codelineno-0-407"> 407</a></span>
<span class="normal"><a href="#__codelineno-0-408"> 408</a></span>
<span class="normal"><a href="#__codelineno-0-409"> 409</a></span>
<span class="normal"><a href="#__codelineno-0-410"> 410</a></span>
<span class="normal"><a href="#__codelineno-0-411"> 411</a></span>
<span class="normal"><a href="#__codelineno-0-412"> 412</a></span>
<span class="normal"><a href="#__codelineno-0-413"> 413</a></span>
<span class="normal"><a href="#__codelineno-0-414"> 414</a></span>
<span class="normal"><a href="#__codelineno-0-415"> 415</a></span>
<span class="normal"><a href="#__codelineno-0-416"> 416</a></span>
<span class="normal"><a href="#__codelineno-0-417"> 417</a></span>
<span class="normal"><a href="#__codelineno-0-418"> 418</a></span>
<span class="normal"><a href="#__codelineno-0-419"> 419</a></span>
<span class="normal"><a href="#__codelineno-0-420"> 420</a></span>
<span class="normal"><a href="#__codelineno-0-421"> 421</a></span>
<span class="normal"><a href="#__codelineno-0-422"> 422</a></span>
<span class="normal"><a href="#__codelineno-0-423"> 423</a></span>
<span class="normal"><a href="#__codelineno-0-424"> 424</a></span>
<span class="normal"><a href="#__codelineno-0-425"> 425</a></span>
<span class="normal"><a href="#__codelineno-0-426"> 426</a></span>
<span class="normal"><a href="#__codelineno-0-427"> 427</a></span>
<span class="normal"><a href="#__codelineno-0-428"> 428</a></span>
<span class="normal"><a href="#__codelineno-0-429"> 429</a></span>
<span class="normal"><a href="#__codelineno-0-430"> 430</a></span>
<span class="normal"><a href="#__codelineno-0-431"> 431</a></span>
<span class="normal"><a href="#__codelineno-0-432"> 432</a></span>
<span class="normal"><a href="#__codelineno-0-433"> 433</a></span>
<span class="normal"><a href="#__codelineno-0-434"> 434</a></span>
<span class="normal"><a href="#__codelineno-0-435"> 435</a></span>
<span class="normal"><a href="#__codelineno-0-436"> 436</a></span>
<span class="normal"><a href="#__codelineno-0-437"> 437</a></span>
<span class="normal"><a href="#__codelineno-0-438"> 438</a></span>
<span class="normal"><a href="#__codelineno-0-439"> 439</a></span>
<span class="normal"><a href="#__codelineno-0-440"> 440</a></span>
<span class="normal"><a href="#__codelineno-0-441"> 441</a></span>
<span class="normal"><a href="#__codelineno-0-442"> 442</a></span>
<span class="normal"><a href="#__codelineno-0-443"> 443</a></span>
<span class="normal"><a href="#__codelineno-0-444"> 444</a></span>
<span class="normal"><a href="#__codelineno-0-445"> 445</a></span>
<span class="normal"><a href="#__codelineno-0-446"> 446</a></span>
<span class="normal"><a href="#__codelineno-0-447"> 447</a></span>
<span class="normal"><a href="#__codelineno-0-448"> 448</a></span>
<span class="normal"><a href="#__codelineno-0-449"> 449</a></span>
<span class="normal"><a href="#__codelineno-0-450"> 450</a></span>
<span class="normal"><a href="#__codelineno-0-451"> 451</a></span>
<span class="normal"><a href="#__codelineno-0-452"> 452</a></span>
<span class="normal"><a href="#__codelineno-0-453"> 453</a></span>
<span class="normal"><a href="#__codelineno-0-454"> 454</a></span>
<span class="normal"><a href="#__codelineno-0-455"> 455</a></span>
<span class="normal"><a href="#__codelineno-0-456"> 456</a></span>
<span class="normal"><a href="#__codelineno-0-457"> 457</a></span>
<span class="normal"><a href="#__codelineno-0-458"> 458</a></span>
<span class="normal"><a href="#__codelineno-0-459"> 459</a></span>
<span class="normal"><a href="#__codelineno-0-460"> 460</a></span>
<span class="normal"><a href="#__codelineno-0-461"> 461</a></span>
<span class="normal"><a href="#__codelineno-0-462"> 462</a></span>
<span class="normal"><a href="#__codelineno-0-463"> 463</a></span>
<span class="normal"><a href="#__codelineno-0-464"> 464</a></span>
<span class="normal"><a href="#__codelineno-0-465"> 465</a></span>
<span class="normal"><a href="#__codelineno-0-466"> 466</a></span>
<span class="normal"><a href="#__codelineno-0-467"> 467</a></span>
<span class="normal"><a href="#__codelineno-0-468"> 468</a></span>
<span class="normal"><a href="#__codelineno-0-469"> 469</a></span>
<span class="normal"><a href="#__codelineno-0-470"> 470</a></span>
<span class="normal"><a href="#__codelineno-0-471"> 471</a></span>
<span class="normal"><a href="#__codelineno-0-472"> 472</a></span>
<span class="normal"><a href="#__codelineno-0-473"> 473</a></span>
<span class="normal"><a href="#__codelineno-0-474"> 474</a></span>
<span class="normal"><a href="#__codelineno-0-475"> 475</a></span>
<span class="normal"><a href="#__codelineno-0-476"> 476</a></span>
<span class="normal"><a href="#__codelineno-0-477"> 477</a></span>
<span class="normal"><a href="#__codelineno-0-478"> 478</a></span>
<span class="normal"><a href="#__codelineno-0-479"> 479</a></span>
<span class="normal"><a href="#__codelineno-0-480"> 480</a></span>
<span class="normal"><a href="#__codelineno-0-481"> 481</a></span>
<span class="normal"><a href="#__codelineno-0-482"> 482</a></span>
<span class="normal"><a href="#__codelineno-0-483"> 483</a></span>
<span class="normal"><a href="#__codelineno-0-484"> 484</a></span>
<span class="normal"><a href="#__codelineno-0-485"> 485</a></span>
<span class="normal"><a href="#__codelineno-0-486"> 486</a></span>
<span class="normal"><a href="#__codelineno-0-487"> 487</a></span>
<span class="normal"><a href="#__codelineno-0-488"> 488</a></span>
<span class="normal"><a href="#__codelineno-0-489"> 489</a></span>
<span class="normal"><a href="#__codelineno-0-490"> 490</a></span>
<span class="normal"><a href="#__codelineno-0-491"> 491</a></span>
<span class="normal"><a href="#__codelineno-0-492"> 492</a></span>
<span class="normal"><a href="#__codelineno-0-493"> 493</a></span>
<span class="normal"><a href="#__codelineno-0-494"> 494</a></span>
<span class="normal"><a href="#__codelineno-0-495"> 495</a></span>
<span class="normal"><a href="#__codelineno-0-496"> 496</a></span>
<span class="normal"><a href="#__codelineno-0-497"> 497</a></span>
<span class="normal"><a href="#__codelineno-0-498"> 498</a></span>
<span class="normal"><a href="#__codelineno-0-499"> 499</a></span>
<span class="normal"><a href="#__codelineno-0-500"> 500</a></span>
<span class="normal"><a href="#__codelineno-0-501"> 501</a></span>
<span class="normal"><a href="#__codelineno-0-502"> 502</a></span>
<span class="normal"><a href="#__codelineno-0-503"> 503</a></span>
<span class="normal"><a href="#__codelineno-0-504"> 504</a></span>
<span class="normal"><a href="#__codelineno-0-505"> 505</a></span>
<span class="normal"><a href="#__codelineno-0-506"> 506</a></span>
<span class="normal"><a href="#__codelineno-0-507"> 507</a></span>
<span class="normal"><a href="#__codelineno-0-508"> 508</a></span>
<span class="normal"><a href="#__codelineno-0-509"> 509</a></span>
<span class="normal"><a href="#__codelineno-0-510"> 510</a></span>
<span class="normal"><a href="#__codelineno-0-511"> 511</a></span>
<span class="normal"><a href="#__codelineno-0-512"> 512</a></span>
<span class="normal"><a href="#__codelineno-0-513"> 513</a></span>
<span class="normal"><a href="#__codelineno-0-514"> 514</a></span>
<span class="normal"><a href="#__codelineno-0-515"> 515</a></span>
<span class="normal"><a href="#__codelineno-0-516"> 516</a></span>
<span class="normal"><a href="#__codelineno-0-517"> 517</a></span>
<span class="normal"><a href="#__codelineno-0-518"> 518</a></span>
<span class="normal"><a href="#__codelineno-0-519"> 519</a></span>
<span class="normal"><a href="#__codelineno-0-520"> 520</a></span>
<span class="normal"><a href="#__codelineno-0-521"> 521</a></span>
<span class="normal"><a href="#__codelineno-0-522"> 522</a></span>
<span class="normal"><a href="#__codelineno-0-523"> 523</a></span>
<span class="normal"><a href="#__codelineno-0-524"> 524</a></span>
<span class="normal"><a href="#__codelineno-0-525"> 525</a></span>
<span class="normal"><a href="#__codelineno-0-526"> 526</a></span>
<span class="normal"><a href="#__codelineno-0-527"> 527</a></span>
<span class="normal"><a href="#__codelineno-0-528"> 528</a></span>
<span class="normal"><a href="#__codelineno-0-529"> 529</a></span>
<span class="normal"><a href="#__codelineno-0-530"> 530</a></span>
<span class="normal"><a href="#__codelineno-0-531"> 531</a></span>
<span class="normal"><a href="#__codelineno-0-532"> 532</a></span>
<span class="normal"><a href="#__codelineno-0-533"> 533</a></span>
<span class="normal"><a href="#__codelineno-0-534"> 534</a></span>
<span class="normal"><a href="#__codelineno-0-535"> 535</a></span>
<span class="normal"><a href="#__codelineno-0-536"> 536</a></span>
<span class="normal"><a href="#__codelineno-0-537"> 537</a></span>
<span class="normal"><a href="#__codelineno-0-538"> 538</a></span>
<span class="normal"><a href="#__codelineno-0-539"> 539</a></span>
<span class="normal"><a href="#__codelineno-0-540"> 540</a></span>
<span class="normal"><a href="#__codelineno-0-541"> 541</a></span>
<span class="normal"><a href="#__codelineno-0-542"> 542</a></span>
<span class="normal"><a href="#__codelineno-0-543"> 543</a></span>
<span class="normal"><a href="#__codelineno-0-544"> 544</a></span>
<span class="normal"><a href="#__codelineno-0-545"> 545</a></span>
<span class="normal"><a href="#__codelineno-0-546"> 546</a></span>
<span class="normal"><a href="#__codelineno-0-547"> 547</a></span>
<span class="normal"><a href="#__codelineno-0-548"> 548</a></span>
<span class="normal"><a href="#__codelineno-0-549"> 549</a></span>
<span class="normal"><a href="#__codelineno-0-550"> 550</a></span>
<span class="normal"><a href="#__codelineno-0-551"> 551</a></span>
<span class="normal"><a href="#__codelineno-0-552"> 552</a></span>
<span class="normal"><a href="#__codelineno-0-553"> 553</a></span>
<span class="normal"><a href="#__codelineno-0-554"> 554</a></span>
<span class="normal"><a href="#__codelineno-0-555"> 555</a></span>
<span class="normal"><a href="#__codelineno-0-556"> 556</a></span>
<span class="normal"><a href="#__codelineno-0-557"> 557</a></span>
<span class="normal"><a href="#__codelineno-0-558"> 558</a></span>
<span class="normal"><a href="#__codelineno-0-559"> 559</a></span>
<span class="normal"><a href="#__codelineno-0-560"> 560</a></span>
<span class="normal"><a href="#__codelineno-0-561"> 561</a></span>
<span class="normal"><a href="#__codelineno-0-562"> 562</a></span>
<span class="normal"><a href="#__codelineno-0-563"> 563</a></span>
<span class="normal"><a href="#__codelineno-0-564"> 564</a></span>
<span class="normal"><a href="#__codelineno-0-565"> 565</a></span>
<span class="normal"><a href="#__codelineno-0-566"> 566</a></span>
<span class="normal"><a href="#__codelineno-0-567"> 567</a></span>
<span class="normal"><a href="#__codelineno-0-568"> 568</a></span>
<span class="normal"><a href="#__codelineno-0-569"> 569</a></span>
<span class="normal"><a href="#__codelineno-0-570"> 570</a></span>
<span class="normal"><a href="#__codelineno-0-571"> 571</a></span>
<span class="normal"><a href="#__codelineno-0-572"> 572</a></span>
<span class="normal"><a href="#__codelineno-0-573"> 573</a></span>
<span class="normal"><a href="#__codelineno-0-574"> 574</a></span>
<span class="normal"><a href="#__codelineno-0-575"> 575</a></span>
<span class="normal"><a href="#__codelineno-0-576"> 576</a></span>
<span class="normal"><a href="#__codelineno-0-577"> 577</a></span>
<span class="normal"><a href="#__codelineno-0-578"> 578</a></span>
<span class="normal"><a href="#__codelineno-0-579"> 579</a></span>
<span class="normal"><a href="#__codelineno-0-580"> 580</a></span>
<span class="normal"><a href="#__codelineno-0-581"> 581</a></span>
<span class="normal"><a href="#__codelineno-0-582"> 582</a></span>
<span class="normal"><a href="#__codelineno-0-583"> 583</a></span>
<span class="normal"><a href="#__codelineno-0-584"> 584</a></span>
<span class="normal"><a href="#__codelineno-0-585"> 585</a></span>
<span class="normal"><a href="#__codelineno-0-586"> 586</a></span>
<span class="normal"><a href="#__codelineno-0-587"> 587</a></span>
<span class="normal"><a href="#__codelineno-0-588"> 588</a></span>
<span class="normal"><a href="#__codelineno-0-589"> 589</a></span>
<span class="normal"><a href="#__codelineno-0-590"> 590</a></span>
<span class="normal"><a href="#__codelineno-0-591"> 591</a></span>
<span class="normal"><a href="#__codelineno-0-592"> 592</a></span>
<span class="normal"><a href="#__codelineno-0-593"> 593</a></span>
<span class="normal"><a href="#__codelineno-0-594"> 594</a></span>
<span class="normal"><a href="#__codelineno-0-595"> 595</a></span>
<span class="normal"><a href="#__codelineno-0-596"> 596</a></span>
<span class="normal"><a href="#__codelineno-0-597"> 597</a></span>
<span class="normal"><a href="#__codelineno-0-598"> 598</a></span>
<span class="normal"><a href="#__codelineno-0-599"> 599</a></span>
<span class="normal"><a href="#__codelineno-0-600"> 600</a></span>
<span class="normal"><a href="#__codelineno-0-601"> 601</a></span>
<span class="normal"><a href="#__codelineno-0-602"> 602</a></span>
<span class="normal"><a href="#__codelineno-0-603"> 603</a></span>
<span class="normal"><a href="#__codelineno-0-604"> 604</a></span>
<span class="normal"><a href="#__codelineno-0-605"> 605</a></span>
<span class="normal"><a href="#__codelineno-0-606"> 606</a></span>
<span class="normal"><a href="#__codelineno-0-607"> 607</a></span>
<span class="normal"><a href="#__codelineno-0-608"> 608</a></span>
<span class="normal"><a href="#__codelineno-0-609"> 609</a></span>
<span class="normal"><a href="#__codelineno-0-610"> 610</a></span>
<span class="normal"><a href="#__codelineno-0-611"> 611</a></span>
<span class="normal"><a href="#__codelineno-0-612"> 612</a></span>
<span class="normal"><a href="#__codelineno-0-613"> 613</a></span>
<span class="normal"><a href="#__codelineno-0-614"> 614</a></span>
<span class="normal"><a href="#__codelineno-0-615"> 615</a></span>
<span class="normal"><a href="#__codelineno-0-616"> 616</a></span>
<span class="normal"><a href="#__codelineno-0-617"> 617</a></span>
<span class="normal"><a href="#__codelineno-0-618"> 618</a></span>
<span class="normal"><a href="#__codelineno-0-619"> 619</a></span>
<span class="normal"><a href="#__codelineno-0-620"> 620</a></span>
<span class="normal"><a href="#__codelineno-0-621"> 621</a></span>
<span class="normal"><a href="#__codelineno-0-622"> 622</a></span>
<span class="normal"><a href="#__codelineno-0-623"> 623</a></span>
<span class="normal"><a href="#__codelineno-0-624"> 624</a></span>
<span class="normal"><a href="#__codelineno-0-625"> 625</a></span>
<span class="normal"><a href="#__codelineno-0-626"> 626</a></span>
<span class="normal"><a href="#__codelineno-0-627"> 627</a></span>
<span class="normal"><a href="#__codelineno-0-628"> 628</a></span>
<span class="normal"><a href="#__codelineno-0-629"> 629</a></span>
<span class="normal"><a href="#__codelineno-0-630"> 630</a></span>
<span class="normal"><a href="#__codelineno-0-631"> 631</a></span>
<span class="normal"><a href="#__codelineno-0-632"> 632</a></span>
<span class="normal"><a href="#__codelineno-0-633"> 633</a></span>
<span class="normal"><a href="#__codelineno-0-634"> 634</a></span>
<span class="normal"><a href="#__codelineno-0-635"> 635</a></span>
<span class="normal"><a href="#__codelineno-0-636"> 636</a></span>
<span class="normal"><a href="#__codelineno-0-637"> 637</a></span>
<span class="normal"><a href="#__codelineno-0-638"> 638</a></span>
<span class="normal"><a href="#__codelineno-0-639"> 639</a></span>
<span class="normal"><a href="#__codelineno-0-640"> 640</a></span>
<span class="normal"><a href="#__codelineno-0-641"> 641</a></span>
<span class="normal"><a href="#__codelineno-0-642"> 642</a></span>
<span class="normal"><a href="#__codelineno-0-643"> 643</a></span>
<span class="normal"><a href="#__codelineno-0-644"> 644</a></span>
<span class="normal"><a href="#__codelineno-0-645"> 645</a></span>
<span class="normal"><a href="#__codelineno-0-646"> 646</a></span>
<span class="normal"><a href="#__codelineno-0-647"> 647</a></span>
<span class="normal"><a href="#__codelineno-0-648"> 648</a></span>
<span class="normal"><a href="#__codelineno-0-649"> 649</a></span>
<span class="normal"><a href="#__codelineno-0-650"> 650</a></span>
<span class="normal"><a href="#__codelineno-0-651"> 651</a></span>
<span class="normal"><a href="#__codelineno-0-652"> 652</a></span>
<span class="normal"><a href="#__codelineno-0-653"> 653</a></span>
<span class="normal"><a href="#__codelineno-0-654"> 654</a></span>
<span class="normal"><a href="#__codelineno-0-655"> 655</a></span>
<span class="normal"><a href="#__codelineno-0-656"> 656</a></span>
<span class="normal"><a href="#__codelineno-0-657"> 657</a></span>
<span class="normal"><a href="#__codelineno-0-658"> 658</a></span>
<span class="normal"><a href="#__codelineno-0-659"> 659</a></span>
<span class="normal"><a href="#__codelineno-0-660"> 660</a></span>
<span class="normal"><a href="#__codelineno-0-661"> 661</a></span>
<span class="normal"><a href="#__codelineno-0-662"> 662</a></span>
<span class="normal"><a href="#__codelineno-0-663"> 663</a></span>
<span class="normal"><a href="#__codelineno-0-664"> 664</a></span>
<span class="normal"><a href="#__codelineno-0-665"> 665</a></span>
<span class="normal"><a href="#__codelineno-0-666"> 666</a></span>
<span class="normal"><a href="#__codelineno-0-667"> 667</a></span>
<span class="normal"><a href="#__codelineno-0-668"> 668</a></span>
<span class="normal"><a href="#__codelineno-0-669"> 669</a></span>
<span class="normal"><a href="#__codelineno-0-670"> 670</a></span>
<span class="normal"><a href="#__codelineno-0-671"> 671</a></span>
<span class="normal"><a href="#__codelineno-0-672"> 672</a></span>
<span class="normal"><a href="#__codelineno-0-673"> 673</a></span>
<span class="normal"><a href="#__codelineno-0-674"> 674</a></span>
<span class="normal"><a href="#__codelineno-0-675"> 675</a></span>
<span class="normal"><a href="#__codelineno-0-676"> 676</a></span>
<span class="normal"><a href="#__codelineno-0-677"> 677</a></span>
<span class="normal"><a href="#__codelineno-0-678"> 678</a></span>
<span class="normal"><a href="#__codelineno-0-679"> 679</a></span>
<span class="normal"><a href="#__codelineno-0-680"> 680</a></span>
<span class="normal"><a href="#__codelineno-0-681"> 681</a></span>
<span class="normal"><a href="#__codelineno-0-682"> 682</a></span>
<span class="normal"><a href="#__codelineno-0-683"> 683</a></span>
<span class="normal"><a href="#__codelineno-0-684"> 684</a></span>
<span class="normal"><a href="#__codelineno-0-685"> 685</a></span>
<span class="normal"><a href="#__codelineno-0-686"> 686</a></span>
<span class="normal"><a href="#__codelineno-0-687"> 687</a></span>
<span class="normal"><a href="#__codelineno-0-688"> 688</a></span>
<span class="normal"><a href="#__codelineno-0-689"> 689</a></span>
<span class="normal"><a href="#__codelineno-0-690"> 690</a></span>
<span class="normal"><a href="#__codelineno-0-691"> 691</a></span>
<span class="normal"><a href="#__codelineno-0-692"> 692</a></span>
<span class="normal"><a href="#__codelineno-0-693"> 693</a></span>
<span class="normal"><a href="#__codelineno-0-694"> 694</a></span>
<span class="normal"><a href="#__codelineno-0-695"> 695</a></span>
<span class="normal"><a href="#__codelineno-0-696"> 696</a></span>
<span class="normal"><a href="#__codelineno-0-697"> 697</a></span>
<span class="normal"><a href="#__codelineno-0-698"> 698</a></span>
<span class="normal"><a href="#__codelineno-0-699"> 699</a></span>
<span class="normal"><a href="#__codelineno-0-700"> 700</a></span>
<span class="normal"><a href="#__codelineno-0-701"> 701</a></span>
<span class="normal"><a href="#__codelineno-0-702"> 702</a></span>
<span class="normal"><a href="#__codelineno-0-703"> 703</a></span>
<span class="normal"><a href="#__codelineno-0-704"> 704</a></span>
<span class="normal"><a href="#__codelineno-0-705"> 705</a></span>
<span class="normal"><a href="#__codelineno-0-706"> 706</a></span>
<span class="normal"><a href="#__codelineno-0-707"> 707</a></span>
<span class="normal"><a href="#__codelineno-0-708"> 708</a></span>
<span class="normal"><a href="#__codelineno-0-709"> 709</a></span>
<span class="normal"><a href="#__codelineno-0-710"> 710</a></span>
<span class="normal"><a href="#__codelineno-0-711"> 711</a></span>
<span class="normal"><a href="#__codelineno-0-712"> 712</a></span>
<span class="normal"><a href="#__codelineno-0-713"> 713</a></span>
<span class="normal"><a href="#__codelineno-0-714"> 714</a></span>
<span class="normal"><a href="#__codelineno-0-715"> 715</a></span>
<span class="normal"><a href="#__codelineno-0-716"> 716</a></span>
<span class="normal"><a href="#__codelineno-0-717"> 717</a></span>
<span class="normal"><a href="#__codelineno-0-718"> 718</a></span>
<span class="normal"><a href="#__codelineno-0-719"> 719</a></span>
<span class="normal"><a href="#__codelineno-0-720"> 720</a></span>
<span class="normal"><a href="#__codelineno-0-721"> 721</a></span>
<span class="normal"><a href="#__codelineno-0-722"> 722</a></span>
<span class="normal"><a href="#__codelineno-0-723"> 723</a></span>
<span class="normal"><a href="#__codelineno-0-724"> 724</a></span>
<span class="normal"><a href="#__codelineno-0-725"> 725</a></span>
<span class="normal"><a href="#__codelineno-0-726"> 726</a></span>
<span class="normal"><a href="#__codelineno-0-727"> 727</a></span>
<span class="normal"><a href="#__codelineno-0-728"> 728</a></span>
<span class="normal"><a href="#__codelineno-0-729"> 729</a></span>
<span class="normal"><a href="#__codelineno-0-730"> 730</a></span>
<span class="normal"><a href="#__codelineno-0-731"> 731</a></span>
<span class="normal"><a href="#__codelineno-0-732"> 732</a></span>
<span class="normal"><a href="#__codelineno-0-733"> 733</a></span>
<span class="normal"><a href="#__codelineno-0-734"> 734</a></span>
<span class="normal"><a href="#__codelineno-0-735"> 735</a></span>
<span class="normal"><a href="#__codelineno-0-736"> 736</a></span>
<span class="normal"><a href="#__codelineno-0-737"> 737</a></span>
<span class="normal"><a href="#__codelineno-0-738"> 738</a></span>
<span class="normal"><a href="#__codelineno-0-739"> 739</a></span>
<span class="normal"><a href="#__codelineno-0-740"> 740</a></span>
<span class="normal"><a href="#__codelineno-0-741"> 741</a></span>
<span class="normal"><a href="#__codelineno-0-742"> 742</a></span>
<span class="normal"><a href="#__codelineno-0-743"> 743</a></span>
<span class="normal"><a href="#__codelineno-0-744"> 744</a></span>
<span class="normal"><a href="#__codelineno-0-745"> 745</a></span>
<span class="normal"><a href="#__codelineno-0-746"> 746</a></span>
<span class="normal"><a href="#__codelineno-0-747"> 747</a></span>
<span class="normal"><a href="#__codelineno-0-748"> 748</a></span>
<span class="normal"><a href="#__codelineno-0-749"> 749</a></span>
<span class="normal"><a href="#__codelineno-0-750"> 750</a></span>
<span class="normal"><a href="#__codelineno-0-751"> 751</a></span>
<span class="normal"><a href="#__codelineno-0-752"> 752</a></span>
<span class="normal"><a href="#__codelineno-0-753"> 753</a></span>
<span class="normal"><a href="#__codelineno-0-754"> 754</a></span>
<span class="normal"><a href="#__codelineno-0-755"> 755</a></span>
<span class="normal"><a href="#__codelineno-0-756"> 756</a></span>
<span class="normal"><a href="#__codelineno-0-757"> 757</a></span>
<span class="normal"><a href="#__codelineno-0-758"> 758</a></span>
<span class="normal"><a href="#__codelineno-0-759"> 759</a></span>
<span class="normal"><a href="#__codelineno-0-760"> 760</a></span>
<span class="normal"><a href="#__codelineno-0-761"> 761</a></span>
<span class="normal"><a href="#__codelineno-0-762"> 762</a></span>
<span class="normal"><a href="#__codelineno-0-763"> 763</a></span>
<span class="normal"><a href="#__codelineno-0-764"> 764</a></span>
<span class="normal"><a href="#__codelineno-0-765"> 765</a></span>
<span class="normal"><a href="#__codelineno-0-766"> 766</a></span>
<span class="normal"><a href="#__codelineno-0-767"> 767</a></span>
<span class="normal"><a href="#__codelineno-0-768"> 768</a></span>
<span class="normal"><a href="#__codelineno-0-769"> 769</a></span>
<span class="normal"><a href="#__codelineno-0-770"> 770</a></span>
<span class="normal"><a href="#__codelineno-0-771"> 771</a></span>
<span class="normal"><a href="#__codelineno-0-772"> 772</a></span>
<span class="normal"><a href="#__codelineno-0-773"> 773</a></span>
<span class="normal"><a href="#__codelineno-0-774"> 774</a></span>
<span class="normal"><a href="#__codelineno-0-775"> 775</a></span>
<span class="normal"><a href="#__codelineno-0-776"> 776</a></span>
<span class="normal"><a href="#__codelineno-0-777"> 777</a></span>
<span class="normal"><a href="#__codelineno-0-778"> 778</a></span>
<span class="normal"><a href="#__codelineno-0-779"> 779</a></span>
<span class="normal"><a href="#__codelineno-0-780"> 780</a></span>
<span class="normal"><a href="#__codelineno-0-781"> 781</a></span>
<span class="normal"><a href="#__codelineno-0-782"> 782</a></span>
<span class="normal"><a href="#__codelineno-0-783"> 783</a></span>
<span class="normal"><a href="#__codelineno-0-784"> 784</a></span>
<span class="normal"><a href="#__codelineno-0-785"> 785</a></span>
<span class="normal"><a href="#__codelineno-0-786"> 786</a></span>
<span class="normal"><a href="#__codelineno-0-787"> 787</a></span>
<span class="normal"><a href="#__codelineno-0-788"> 788</a></span>
<span class="normal"><a href="#__codelineno-0-789"> 789</a></span>
<span class="normal"><a href="#__codelineno-0-790"> 790</a></span>
<span class="normal"><a href="#__codelineno-0-791"> 791</a></span>
<span class="normal"><a href="#__codelineno-0-792"> 792</a></span>
<span class="normal"><a href="#__codelineno-0-793"> 793</a></span>
<span class="normal"><a href="#__codelineno-0-794"> 794</a></span>
<span class="normal"><a href="#__codelineno-0-795"> 795</a></span>
<span class="normal"><a href="#__codelineno-0-796"> 796</a></span>
<span class="normal"><a href="#__codelineno-0-797"> 797</a></span>
<span class="normal"><a href="#__codelineno-0-798"> 798</a></span>
<span class="normal"><a href="#__codelineno-0-799"> 799</a></span>
<span class="normal"><a href="#__codelineno-0-800"> 800</a></span>
<span class="normal"><a href="#__codelineno-0-801"> 801</a></span>
<span class="normal"><a href="#__codelineno-0-802"> 802</a></span>
<span class="normal"><a href="#__codelineno-0-803"> 803</a></span>
<span class="normal"><a href="#__codelineno-0-804"> 804</a></span>
<span class="normal"><a href="#__codelineno-0-805"> 805</a></span>
<span class="normal"><a href="#__codelineno-0-806"> 806</a></span>
<span class="normal"><a href="#__codelineno-0-807"> 807</a></span>
<span class="normal"><a href="#__codelineno-0-808"> 808</a></span>
<span class="normal"><a href="#__codelineno-0-809"> 809</a></span>
<span class="normal"><a href="#__codelineno-0-810"> 810</a></span>
<span class="normal"><a href="#__codelineno-0-811"> 811</a></span>
<span class="normal"><a href="#__codelineno-0-812"> 812</a></span>
<span class="normal"><a href="#__codelineno-0-813"> 813</a></span>
<span class="normal"><a href="#__codelineno-0-814"> 814</a></span>
<span class="normal"><a href="#__codelineno-0-815"> 815</a></span>
<span class="normal"><a href="#__codelineno-0-816"> 816</a></span>
<span class="normal"><a href="#__codelineno-0-817"> 817</a></span>
<span class="normal"><a href="#__codelineno-0-818"> 818</a></span>
<span class="normal"><a href="#__codelineno-0-819"> 819</a></span>
<span class="normal"><a href="#__codelineno-0-820"> 820</a></span>
<span class="normal"><a href="#__codelineno-0-821"> 821</a></span>
<span class="normal"><a href="#__codelineno-0-822"> 822</a></span>
<span class="normal"><a href="#__codelineno-0-823"> 823</a></span>
<span class="normal"><a href="#__codelineno-0-824"> 824</a></span>
<span class="normal"><a href="#__codelineno-0-825"> 825</a></span>
<span class="normal"><a href="#__codelineno-0-826"> 826</a></span>
<span class="normal"><a href="#__codelineno-0-827"> 827</a></span>
<span class="normal"><a href="#__codelineno-0-828"> 828</a></span>
<span class="normal"><a href="#__codelineno-0-829"> 829</a></span>
<span class="normal"><a href="#__codelineno-0-830"> 830</a></span>
<span class="normal"><a href="#__codelineno-0-831"> 831</a></span>
<span class="normal"><a href="#__codelineno-0-832"> 832</a></span>
<span class="normal"><a href="#__codelineno-0-833"> 833</a></span>
<span class="normal"><a href="#__codelineno-0-834"> 834</a></span>
<span class="normal"><a href="#__codelineno-0-835"> 835</a></span>
<span class="normal"><a href="#__codelineno-0-836"> 836</a></span>
<span class="normal"><a href="#__codelineno-0-837"> 837</a></span>
<span class="normal"><a href="#__codelineno-0-838"> 838</a></span>
<span class="normal"><a href="#__codelineno-0-839"> 839</a></span>
<span class="normal"><a href="#__codelineno-0-840"> 840</a></span>
<span class="normal"><a href="#__codelineno-0-841"> 841</a></span>
<span class="normal"><a href="#__codelineno-0-842"> 842</a></span>
<span class="normal"><a href="#__codelineno-0-843"> 843</a></span>
<span class="normal"><a href="#__codelineno-0-844"> 844</a></span>
<span class="normal"><a href="#__codelineno-0-845"> 845</a></span>
<span class="normal"><a href="#__codelineno-0-846"> 846</a></span>
<span class="normal"><a href="#__codelineno-0-847"> 847</a></span>
<span class="normal"><a href="#__codelineno-0-848"> 848</a></span>
<span class="normal"><a href="#__codelineno-0-849"> 849</a></span>
<span class="normal"><a href="#__codelineno-0-850"> 850</a></span>
<span class="normal"><a href="#__codelineno-0-851"> 851</a></span>
<span class="normal"><a href="#__codelineno-0-852"> 852</a></span>
<span class="normal"><a href="#__codelineno-0-853"> 853</a></span>
<span class="normal"><a href="#__codelineno-0-854"> 854</a></span>
<span class="normal"><a href="#__codelineno-0-855"> 855</a></span>
<span class="normal"><a href="#__codelineno-0-856"> 856</a></span>
<span class="normal"><a href="#__codelineno-0-857"> 857</a></span>
<span class="normal"><a href="#__codelineno-0-858"> 858</a></span>
<span class="normal"><a href="#__codelineno-0-859"> 859</a></span>
<span class="normal"><a href="#__codelineno-0-860"> 860</a></span>
<span class="normal"><a href="#__codelineno-0-861"> 861</a></span>
<span class="normal"><a href="#__codelineno-0-862"> 862</a></span>
<span class="normal"><a href="#__codelineno-0-863"> 863</a></span>
<span class="normal"><a href="#__codelineno-0-864"> 864</a></span>
<span class="normal"><a href="#__codelineno-0-865"> 865</a></span>
<span class="normal"><a href="#__codelineno-0-866"> 866</a></span>
<span class="normal"><a href="#__codelineno-0-867"> 867</a></span>
<span class="normal"><a href="#__codelineno-0-868"> 868</a></span>
<span class="normal"><a href="#__codelineno-0-869"> 869</a></span>
<span class="normal"><a href="#__codelineno-0-870"> 870</a></span>
<span class="normal"><a href="#__codelineno-0-871"> 871</a></span>
<span class="normal"><a href="#__codelineno-0-872"> 872</a></span>
<span class="normal"><a href="#__codelineno-0-873"> 873</a></span>
<span class="normal"><a href="#__codelineno-0-874"> 874</a></span>
<span class="normal"><a href="#__codelineno-0-875"> 875</a></span>
<span class="normal"><a href="#__codelineno-0-876"> 876</a></span>
<span class="normal"><a href="#__codelineno-0-877"> 877</a></span>
<span class="normal"><a href="#__codelineno-0-878"> 878</a></span>
<span class="normal"><a href="#__codelineno-0-879"> 879</a></span>
<span class="normal"><a href="#__codelineno-0-880"> 880</a></span>
<span class="normal"><a href="#__codelineno-0-881"> 881</a></span>
<span class="normal"><a href="#__codelineno-0-882"> 882</a></span>
<span class="normal"><a href="#__codelineno-0-883"> 883</a></span>
<span class="normal"><a href="#__codelineno-0-884"> 884</a></span>
<span class="normal"><a href="#__codelineno-0-885"> 885</a></span>
<span class="normal"><a href="#__codelineno-0-886"> 886</a></span>
<span class="normal"><a href="#__codelineno-0-887"> 887</a></span>
<span class="normal"><a href="#__codelineno-0-888"> 888</a></span>
<span class="normal"><a href="#__codelineno-0-889"> 889</a></span>
<span class="normal"><a href="#__codelineno-0-890"> 890</a></span>
<span class="normal"><a href="#__codelineno-0-891"> 891</a></span>
<span class="normal"><a href="#__codelineno-0-892"> 892</a></span>
<span class="normal"><a href="#__codelineno-0-893"> 893</a></span>
<span class="normal"><a href="#__codelineno-0-894"> 894</a></span>
<span class="normal"><a href="#__codelineno-0-895"> 895</a></span>
<span class="normal"><a href="#__codelineno-0-896"> 896</a></span>
<span class="normal"><a href="#__codelineno-0-897"> 897</a></span>
<span class="normal"><a href="#__codelineno-0-898"> 898</a></span>
<span class="normal"><a href="#__codelineno-0-899"> 899</a></span>
<span class="normal"><a href="#__codelineno-0-900"> 900</a></span>
<span class="normal"><a href="#__codelineno-0-901"> 901</a></span>
<span class="normal"><a href="#__codelineno-0-902"> 902</a></span>
<span class="normal"><a href="#__codelineno-0-903"> 903</a></span>
<span class="normal"><a href="#__codelineno-0-904"> 904</a></span>
<span class="normal"><a href="#__codelineno-0-905"> 905</a></span>
<span class="normal"><a href="#__codelineno-0-906"> 906</a></span>
<span class="normal"><a href="#__codelineno-0-907"> 907</a></span>
<span class="normal"><a href="#__codelineno-0-908"> 908</a></span>
<span class="normal"><a href="#__codelineno-0-909"> 909</a></span>
<span class="normal"><a href="#__codelineno-0-910"> 910</a></span>
<span class="normal"><a href="#__codelineno-0-911"> 911</a></span>
<span class="normal"><a href="#__codelineno-0-912"> 912</a></span>
<span class="normal"><a href="#__codelineno-0-913"> 913</a></span>
<span class="normal"><a href="#__codelineno-0-914"> 914</a></span>
<span class="normal"><a href="#__codelineno-0-915"> 915</a></span>
<span class="normal"><a href="#__codelineno-0-916"> 916</a></span>
<span class="normal"><a href="#__codelineno-0-917"> 917</a></span>
<span class="normal"><a href="#__codelineno-0-918"> 918</a></span>
<span class="normal"><a href="#__codelineno-0-919"> 919</a></span>
<span class="normal"><a href="#__codelineno-0-920"> 920</a></span>
<span class="normal"><a href="#__codelineno-0-921"> 921</a></span>
<span class="normal"><a href="#__codelineno-0-922"> 922</a></span>
<span class="normal"><a href="#__codelineno-0-923"> 923</a></span>
<span class="normal"><a href="#__codelineno-0-924"> 924</a></span>
<span class="normal"><a href="#__codelineno-0-925"> 925</a></span>
<span class="normal"><a href="#__codelineno-0-926"> 926</a></span>
<span class="normal"><a href="#__codelineno-0-927"> 927</a></span>
<span class="normal"><a href="#__codelineno-0-928"> 928</a></span>
<span class="normal"><a href="#__codelineno-0-929"> 929</a></span>
<span class="normal"><a href="#__codelineno-0-930"> 930</a></span>
<span class="normal"><a href="#__codelineno-0-931"> 931</a></span>
<span class="normal"><a href="#__codelineno-0-932"> 932</a></span>
<span class="normal"><a href="#__codelineno-0-933"> 933</a></span>
<span class="normal"><a href="#__codelineno-0-934"> 934</a></span>
<span class="normal"><a href="#__codelineno-0-935"> 935</a></span>
<span class="normal"><a href="#__codelineno-0-936"> 936</a></span>
<span class="normal"><a href="#__codelineno-0-937"> 937</a></span>
<span class="normal"><a href="#__codelineno-0-938"> 938</a></span>
<span class="normal"><a href="#__codelineno-0-939"> 939</a></span>
<span class="normal"><a href="#__codelineno-0-940"> 940</a></span>
<span class="normal"><a href="#__codelineno-0-941"> 941</a></span>
<span class="normal"><a href="#__codelineno-0-942"> 942</a></span>
<span class="normal"><a href="#__codelineno-0-943"> 943</a></span>
<span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="k">class</span><span class="w"> </span><span class="nc">Trainer</span><span class="p">:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_run_eagerly</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">compiled</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reward</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">steps_per_execution</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>        <span class="c1"># Can be set by callbacks in on_train_begin</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_initial_epoch</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_compute_reward_has_training_arg</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>            <span class="s2">&quot;training&quot;</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">compute_reward</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="p">)</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>        <span class="c1"># Placeholders used in `compile`</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_optimizer</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_compile_reward</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_compile_metrics</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_reward_tracker</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="nd">@tracking</span><span class="o">.</span><span class="n">no_automatic_dependency_tracking</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compile</span><span class="p">(</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="n">optimizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="n">reward</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="n">reward_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="n">metrics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="n">run_eagerly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="n">steps_per_execution</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>    <span class="p">):</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Configures the program for training.</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        Example:</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        ```python</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        program.compile(</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">            optimizer=synalinks.optimizers.RandomFewShot(),</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">            reward=synalinks.rewards.ExactMatch(),</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">            metrics=[</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">                synalinks.metrics.MeanMetricWrapper(synalinks.rewards.exact_match),</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">            ],</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        )</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        ```</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">            optimizer (Optimizer): Optimizer instance. See `synalinks.optimizers`.</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">            reward (Reward): Reward function. A `synalinks.rewards.Reward`</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">                instance. See `synalinks.rewards`. A reward function is</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">                any callable with the signature `reward = fn(y_true, y_pred)`,</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">                where `y_true` are the ground truth values, and `y_pred`</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">                are the program&#39;s predictions.</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">                `y_true` should be a list of batch size length `[d0, .. dN]`.</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">                `y_pred` should be a list of batch size length `[d0, .. dN]`.</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">                The reward function should return a float.</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">            reward_weights (list): Optional list specifying scalar coefficients</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">                (Python floats) to weight the reward contributions of</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">                different program outputs. The reward value that will be maximized</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">                by the program will then be the *weighted sum* of all individual</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">                rewards, weighted by the `reward_weights` coefficients. It is</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">                expected to have a 1:1 mapping to the program&#39;s outputs.</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">            metrics (list): List of metrics to be evaluated by the program during</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">                training and testing. Each of it is a `synalinks.metrics.Metric`</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">                instance. See `synalinks.metrics`. A function is any callable with the</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">                signature `result = fn(y_true, y_pred)`.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">            run_eagerly (bool): If `True`, this program&#39;s forward pass</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">                 will never be compiled. It is recommended to leave this</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">                 as `False` when training (for best performance),</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">                 and to set it to `True` when debugging.</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">            steps_per_execution (int): The number of batches to run</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">                during each a single compiled function call. Running multiple</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">                batches inside a single compiled function call can</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">                greatly improve performance on TPUs or small programs with a large</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">                Python overhead. At most, one full epoch will be run each</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">                execution. If a number larger than the size of the epoch is</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">                passed, the execution will be truncated to the size of the</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">                epoch. Note that if `steps_per_execution` is set to `N`,</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">                `Callback.on_batch_begin` and `Callback.on_batch_end` methods</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">                will only be called every `N` batches (i.e. before/after</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">                each compiled function execution).</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_clear_previous_trainer_metrics</span><span class="p">()</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_optimizer</span> <span class="o">=</span> <span class="n">optimizer</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;output_names&quot;</span><span class="p">):</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="n">output_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_names</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="n">output_names</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="k">if</span> <span class="n">reward</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_compile_reward</span> <span class="o">=</span> <span class="n">CompileReward</span><span class="p">(</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>                <span class="n">reward</span><span class="p">,</span> <span class="n">reward_weights</span><span class="p">,</span> <span class="n">output_names</span><span class="o">=</span><span class="n">output_names</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>            <span class="p">)</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reward</span> <span class="o">=</span> <span class="n">reward</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="k">if</span> <span class="n">metrics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_compile_metrics</span> <span class="o">=</span> <span class="n">CompileMetrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">output_names</span><span class="o">=</span><span class="n">output_names</span><span class="p">)</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">run_eagerly</span> <span class="o">=</span> <span class="n">run_eagerly</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stop_training</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">compiled</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_reward_tracker</span> <span class="o">=</span> <span class="n">metrics_module</span><span class="o">.</span><span class="n">Mean</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;reward&quot;</span><span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">steps_per_execution</span> <span class="o">=</span> <span class="n">steps_per_execution</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_compile_config</span> <span class="o">=</span> <span class="n">serialization_lib</span><span class="o">.</span><span class="n">SerializableDict</span><span class="p">(</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>            <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>            <span class="n">reward</span><span class="o">=</span><span class="n">reward</span><span class="p">,</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="n">reward_weights</span><span class="o">=</span><span class="n">reward_weights</span><span class="p">,</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>            <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">,</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="n">run_eagerly</span><span class="o">=</span><span class="n">run_eagerly</span><span class="p">,</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>            <span class="n">steps_per_execution</span><span class="o">=</span><span class="n">steps_per_execution</span><span class="p">,</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="p">)</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">optimizer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimizer</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="c1"># Order: reward tracker, individual reward trackers, compiled metrics,</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="c1"># custom metrcis, submodule metrics.</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="n">metrics</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiled</span><span class="p">:</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reward_tracker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>                <span class="n">metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reward_tracker</span><span class="p">)</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_metrics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>                <span class="n">metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_compile_metrics</span><span class="p">)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_reward</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>                <span class="n">metrics</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_compile_reward</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="n">metrics</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span><span class="p">)</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten_modules</span><span class="p">(</span><span class="n">include_self</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">Trainer</span><span class="p">):</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>                <span class="c1"># All Trainer-related metrics in submodules should be ignored</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>                <span class="c1"># because a new Trainer has been instantiated.</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>                <span class="k">continue</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>            <span class="n">metrics</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="k">return</span> <span class="n">metrics</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">metrics_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="k">return</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">]</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reset_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">:</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>            <span class="n">m</span><span class="o">.</span><span class="n">reset_state</span><span class="p">()</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_own_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="n">metrics</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reward_tracker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>            <span class="n">metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reward_tracker</span><span class="p">)</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_metrics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>            <span class="n">metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_compile_metrics</span><span class="p">)</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_reward</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>            <span class="n">metrics</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_compile_reward</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="n">metrics</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span><span class="p">)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="k">return</span> <span class="n">metrics</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_clear_previous_trainer_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten_modules</span><span class="p">(</span><span class="n">include_self</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">Trainer</span><span class="p">):</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>                <span class="k">continue</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>            <span class="c1"># A submodule might be a Trainer. In that case, we need to clear</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>            <span class="c1"># the Trainer-related metrics, as they are not usable when a</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>            <span class="c1"># new Trainer is instantiated.</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_own_metrics</span><span class="p">():</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>                <span class="n">module</span><span class="o">.</span><span class="n">_tracker</span><span class="o">.</span><span class="n">untrack</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>            <span class="n">module</span><span class="o">.</span><span class="n">_reward_tracker</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>            <span class="n">module</span><span class="o">.</span><span class="n">_compile_metrics</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>            <span class="k">if</span> <span class="n">module</span><span class="o">.</span><span class="n">_compile_reward</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>                <span class="n">module</span><span class="o">.</span><span class="n">_compile_reward</span><span class="o">.</span><span class="n">_metrics</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>            <span class="n">module</span><span class="o">.</span><span class="n">_metrics</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_eagerly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_eagerly</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>    <span class="nd">@run_eagerly</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_eagerly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_run_eagerly</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">compute_reward</span><span class="p">(</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="n">y_pred</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="n">sample_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="p">):</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the total reward, validate it, and return it.</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">        Subclasses can optionally override this method to provide custom reward</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">        computation logic.</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">            x (list): Input data.</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">            y (list): Target data.</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">            y_pred (list): Predictions returned by the program (output of `program(x)`).</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">            training (bool): Whether we are training or evaluating the program.</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">            (float | None): The total reward as a scalar, or `None` if no reward results</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">                (which is the case when called by `Program.test_step`).</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="c1"># The default implementation does not use `x` or `training`.</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="k">del</span> <span class="n">x</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="k">del</span> <span class="n">training</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>        <span class="n">rewards</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_reward</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>            <span class="k">for</span> <span class="n">y_t</span><span class="p">,</span> <span class="n">y_p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>                <span class="n">reward</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_reward</span><span class="p">(</span><span class="n">y_t</span><span class="p">,</span> <span class="n">y_p</span><span class="p">)</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>                <span class="k">if</span> <span class="n">reward</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>                    <span class="n">rewards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reward</span><span class="p">)</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="k">for</span> <span class="n">reward</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">:</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>            <span class="n">rewards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">reward</span><span class="p">))</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rewards</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>            <span class="n">total_reward</span> <span class="o">=</span> <span class="n">rewards</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">rewards</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>            <span class="n">total_reward</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(())</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>            <span class="n">total_reward</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rewards</span><span class="p">)</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">total_reward</span><span class="p">)</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stateless_compute_reward</span><span class="p">(</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="n">trainable_variables</span><span class="p">,</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="n">non_trainable_variables</span><span class="p">,</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="n">metrics_variables</span><span class="p">,</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>        <span class="n">y_pred</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="n">sample_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>    <span class="p">):</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="n">var_mapping</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainable_variables</span><span class="p">,</span> <span class="n">trainable_variables</span><span class="p">))</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="n">var_mapping</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_trainable_variables</span><span class="p">,</span> <span class="n">non_trainable_variables</span><span class="p">))</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="n">var_mapping</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metrics_variables</span><span class="p">,</span> <span class="n">metrics_variables</span><span class="p">))</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="k">with</span> <span class="n">backend</span><span class="o">.</span><span class="n">StatelessScope</span><span class="p">(</span><span class="n">state_mapping</span><span class="o">=</span><span class="n">var_mapping</span><span class="p">)</span> <span class="k">as</span> <span class="n">scope</span><span class="p">:</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>            <span class="c1"># Note that this is needed for the regularization reward, which need</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>            <span class="c1"># the latest value of train/non-trainable variables.</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>            <span class="n">reward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_reward</span><span class="p">(</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>                <span class="n">x</span><span class="p">,</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>                <span class="n">y</span><span class="p">,</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>                <span class="n">y_pred</span><span class="p">,</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>                <span class="n">sample_weight</span><span class="o">=</span><span class="n">sample_weight</span><span class="p">,</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>                <span class="n">training</span><span class="o">=</span><span class="n">training</span><span class="p">,</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>            <span class="p">)</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>        <span class="c1"># Update non trainable vars (may have been updated in compute_reward)</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>        <span class="n">non_trainable_variables</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">non_trainable_variables</span><span class="p">:</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>            <span class="n">new_v</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">get_current_value</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>            <span class="n">non_trainable_variables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_v</span><span class="p">)</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>        <span class="c1"># Update metrics vars (may have been updated in compute_reward)</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>        <span class="n">metrics_variables</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics_variables</span><span class="p">:</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>            <span class="n">new_v</span> <span class="o">=</span> <span class="n">scope</span><span class="o">.</span><span class="n">get_current_value</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>            <span class="n">metrics_variables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_v</span><span class="p">)</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>        <span class="k">return</span> <span class="n">reward</span><span class="p">,</span> <span class="p">(</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>            <span class="n">trainable_variables</span><span class="p">,</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>            <span class="n">non_trainable_variables</span><span class="p">,</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>            <span class="n">metrics_variables</span><span class="p">,</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>        <span class="p">)</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">compute_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update metric states and collect all metrics to be returned.</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">        Subclasses can optionally override this method to provide custom metric</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">        updating and collection logic. Custom metrics are not passed in</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">        `compile()`, they can be created in `__init__` or `build`. They are</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">        automatically tracked and returned by `self.metrics`.</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">        ```</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">            x: Input data.</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">            y: Target data.</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">            y_pred: Predictions returned by the program output of `program.call(x)`.</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">            A `dict` containing values that will be passed to</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">                `synalinks.callbacks.CallbackList.on_train_batch_end()`. Typically,</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">                the values of the metrics listed in `self.metrics` are returned.</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">                Example: `{&#39;reward&#39;: 0.2, &#39;accuracy&#39;: 0.7}`.</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="k">del</span> <span class="n">x</span>  <span class="c1"># The default implementation does not use `x`.</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_metrics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>            <span class="k">for</span> <span class="n">y_t</span><span class="p">,</span> <span class="n">y_p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_metrics</span><span class="o">.</span><span class="n">update_state</span><span class="p">(</span><span class="n">y_t</span><span class="p">,</span> <span class="n">y_p</span><span class="p">)</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_metrics_result</span><span class="p">()</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_metrics_result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the program&#39;s metrics values as a dict.</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">        If any of the metric result is a dict (containing multiple metrics),</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">        each of them gets added to the top level returned dict of this method.</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">            (dict): A `dict` containing values of the metrics listed in `self.metrics`.</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">                Example: `{&#39;reward&#39;: 0.2, &#39;accuracy&#39;: 0.7}`.</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>        <span class="n">return_metrics</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>        <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">:</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>                <span class="n">return_metrics</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>                <span class="n">return_metrics</span><span class="p">[</span><span class="n">metric</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>        <span class="k">return</span> <span class="n">python_utils</span><span class="o">.</span><span class="n">pythonify_logs</span><span class="p">(</span><span class="n">return_metrics</span><span class="p">)</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>        <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>        <span class="n">batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>        <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>        <span class="n">verbose</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>        <span class="n">callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>        <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>        <span class="n">validation_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>        <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>        <span class="n">initial_epoch</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>        <span class="n">steps_per_epoch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>        <span class="n">validation_steps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>        <span class="n">validation_batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>        <span class="n">validation_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>    <span class="p">):</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Trains the program for a fixed number of epochs (dataset iterations).</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">            x (np.ndarray | generator): Input data. It can be:</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">                - A NumPy array (or array-like), or a list of `DataModel` arrays</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">                    (in case the model has multiple inputs).</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="sd">                - A list of dict mapping input names to the corresponding `DataModel`s,</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="sd">                    if the program has named inputs.</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="sd">                - A Python generator function yielding `(inputs, targets)`.</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="sd">            y (np.ndarray): Target data. Like the input data `x`, it can be either NumPy</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a><span class="sd">                array(s) of `DataModel`(s). If `x` is a Python generator function,</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">                `y` should not be specified since targets will be obtained from</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="sd">                `x`.</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a><span class="sd">            batch_size (int): Integer or `None`.</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">                Number of samples per batch of computation.</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a><span class="sd">                If unspecified, `batch_size` will default to 32.</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="sd">                Do not specify the `batch_size` if your input data `x` is a</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a><span class="sd">                Python generator function since they generate batches.</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a><span class="sd">            epochs (int): Integer. Number of epochs to train the program.</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a><span class="sd">                An epoch is an iteration over the entire `x` and `y`</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a><span class="sd">                data provided (unless the `steps_per_epoch` flag is set to</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a><span class="sd">                something other than None).</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a><span class="sd">                Note that in conjunction with `initial_epoch`,</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="sd">                `epochs` is to be understood as &quot;final epoch&quot;.</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="sd">                The program is not trained for a number of iterations</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="sd">                given by `epochs`, but merely until the epoch</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="sd">                of index `epochs` is reached.</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="sd">            verbose (int): `&quot;auto&quot;`, 0, 1, or 2. Verbosity mode.</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">                0 = silent, 1 = progress bar, 2 = one line per epoch.</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a><span class="sd">                &quot;auto&quot; becomes 1 for most cases.</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="sd">                Note that the progress bar is not</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a><span class="sd">                particularly useful when logged to a file,</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="sd">                so `verbose=2` is recommended when not running interactively</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a><span class="sd">                (e.g., in a production environment). Defaults to `&quot;auto&quot;`.</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="sd">            callbacks (list): List of `synalinks.callbacks.Callback` instances.</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="sd">                List of callbacks to apply during training.</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a><span class="sd">                See `synalinks.callbacks`. Note</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="sd">                `synalinks.callbacks.ProgbarLogger` and</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="sd">                `synalinks.callbacks.History` callbacks are created</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">                automatically and need not be passed to `program.fit()`.</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="sd">                `synalinks.callbacks.ProgbarLogger` is created</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">                or not based on the `verbose` argument in `program.fit()`.</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a><span class="sd">            validation_split (float): Float between 0 and 1.</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">                Fraction of the training data to be used as validation data.</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">                The program will set apart this fraction of the training data,</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">                will not train on it, and will evaluate the reward and any program</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">                metrics on this data at the end of each epoch. The validation</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">                data is selected from the last samples in the `x` and `y` data</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">                provided, before shuffling.</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">                This argument is only supported when `x` and `y` are made of</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">                data_models.</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">                If both `validation_data` and `validation_split` are provided,</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">                `validation_data` will override `validation_split`.</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="sd">            validation_data (tuple | iterator): Data on which to evaluate</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">                the reward and any program metrics at the end of each epoch.</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">                The program will not be trained on this data.</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">                `validation_data` will override `validation_split`.</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">                It can be:</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">                - A tuple `(x_val, y_val)` of `DataModel`s lists.</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">            shuffle (bool): Whether to shuffle the training data before each</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">                epoch. This argument is ignored when `x` is a Python generator function.</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">            initial_epoch (int): Integer.</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="sd">                Epoch at which to start training</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">                (useful for resuming a previous training run).</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="sd">            steps_per_epoch (int): Integer or `None`.</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="sd">                Total number of steps (batches of samples) before declaring one</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a><span class="sd">                epoch finished and starting the next epoch. When training with</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a><span class="sd">                input data_models arrays, the default `None` means that the</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a><span class="sd">                value used is the number of samples in your dataset divided by</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="sd">                the batch size, or 1 if that cannot be determined.</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="sd">                If `x` is a Python generator function, the</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a><span class="sd">                epoch will run until the input dataset is exhausted. When</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a><span class="sd">                passing an infinitely repeating dataset, you must specify the</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a><span class="sd">                `steps_per_epoch` argument, otherwise the training will run</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">                indefinitely.</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a><span class="sd">            validation_steps (int): Integer or `None`.</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="sd">                Only relevant if `validation_data` is provided.</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="sd">                Total number of steps (batches of samples) to draw before</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a><span class="sd">                stopping when performing validation at the end of every epoch.</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="sd">                If `validation_steps` is `None`, validation will run until the</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a><span class="sd">                `validation_data` dataset is exhausted. In the case of an</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="sd">                infinitely repeating dataset, it will run indefinitely. If</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a><span class="sd">                `validation_steps` is specified and only part of the dataset</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="sd">                is consumed, the evaluation will start from the beginning of the</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="sd">                dataset at each epoch. This ensures that the same validation</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="sd">                samples are used every time.</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">            validation_batch_size (int): Integer or `None`.</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="sd">                Number of samples per validation batch.</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a><span class="sd">                If unspecified, will default to `batch_size`.</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="sd">                Do not specify the `validation_batch_size` if your data is a</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="sd">                `synalinks.utils.PyDataset`, `tf.data.Dataset`,</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">                `torch.utils.data.DataLoader` or Python generator function</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">                since they generate batches.</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">            validation_freq (int): Only relevant if validation data is provided.</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="sd">                Specifies how many training epochs to run</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">                before a new validation run is performed,</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="sd">                e.g. `validation_freq=2` runs validation every 2 epochs.</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">            (History): A `History` object. Its `History.history` attribute is</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">                a record of training reward values and metrics values</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">                at successive epochs, as well as validation reward values</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">                and validation metrics values (if applicable).</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_compile_called</span><span class="p">(</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>        <span class="c1"># TODO: respect compiled trainable state</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_eval_epoch_iterator</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>        <span class="k">if</span> <span class="n">validation_split</span> <span class="ow">and</span> <span class="n">validation_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>            <span class="c1"># Create the validation data using the training data. Only supported</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>            <span class="c1"># for numpy arrays.</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>            <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">validation_data</span> <span class="o">=</span> <span class="n">array_slicing</span><span class="o">.</span><span class="n">train_validation_split</span><span class="p">(</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>                <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">validation_split</span><span class="o">=</span><span class="n">validation_split</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>            <span class="p">)</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>        <span class="k">if</span> <span class="n">validation_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>            <span class="p">(</span><span class="n">val_x</span><span class="p">,</span> <span class="n">val_y</span><span class="p">)</span> <span class="o">=</span> <span class="n">data_adapter_utils</span><span class="o">.</span><span class="n">unpack_x_y</span><span class="p">(</span><span class="n">validation_data</span><span class="p">)</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>        <span class="c1"># Create an iterator that yields batches of input/target data.</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>        <span class="n">epoch_iterator</span> <span class="o">=</span> <span class="n">EpochIterator</span><span class="p">(</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>            <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>            <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>            <span class="n">steps_per_epoch</span><span class="o">=</span><span class="n">steps_per_epoch</span><span class="p">,</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>            <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>            <span class="n">steps_per_execution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">steps_per_execution</span><span class="p">,</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>        <span class="p">)</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">built</span> <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten_modules</span><span class="p">()):</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>            <span class="c1"># Build the model on one batch of data.</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">epoch_iterator</span><span class="p">:</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>                <span class="n">data_batch</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_auto_build</span><span class="p">(</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>                    <span class="n">iterator</span><span class="o">=</span><span class="n">epoch_iterator</span><span class="p">,</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>                    <span class="n">data_batch</span><span class="o">=</span><span class="n">data_batch</span><span class="p">,</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>                <span class="p">)</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>                <span class="k">break</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>        <span class="n">epoch_iterator</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>        <span class="c1"># Container that configures and calls callbacks.</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">callbacks</span><span class="p">,</span> <span class="n">callbacks_module</span><span class="o">.</span><span class="n">CallbackList</span><span class="p">):</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>            <span class="n">callbacks</span> <span class="o">=</span> <span class="n">callbacks_module</span><span class="o">.</span><span class="n">CallbackList</span><span class="p">(</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>                <span class="n">callbacks</span><span class="p">,</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>                <span class="n">add_history</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>                <span class="n">add_progbar</span><span class="o">=</span><span class="n">verbose</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>                <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>                <span class="n">steps</span><span class="o">=</span><span class="n">steps_per_epoch</span><span class="p">,</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>                <span class="n">program</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>            <span class="p">)</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stop_training</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>        <span class="n">callbacks</span><span class="o">.</span><span class="n">on_train_begin</span><span class="p">()</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>        <span class="n">training_logs</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>        <span class="n">logs</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>        <span class="n">initial_epoch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initial_epoch</span> <span class="ow">or</span> <span class="n">initial_epoch</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>        <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">initial_epoch</span><span class="p">,</span> <span class="n">epochs</span><span class="p">):</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">reset_metrics</span><span class="p">()</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>            <span class="n">callbacks</span><span class="o">.</span><span class="n">on_epoch_begin</span><span class="p">(</span><span class="n">epoch</span><span class="p">)</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>            <span class="k">with</span> <span class="n">epoch_iterator</span><span class="o">.</span><span class="n">catch_stop_iteration</span><span class="p">():</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>                <span class="k">for</span> <span class="n">step</span><span class="p">,</span> <span class="n">iterator</span> <span class="ow">in</span> <span class="n">epoch_iterator</span><span class="p">:</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>                    <span class="n">data</span> <span class="o">=</span> <span class="n">iterator</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>                    <span class="n">x_batch</span><span class="p">,</span> <span class="n">y_batch</span> <span class="o">=</span> <span class="n">data_adapter_utils</span><span class="o">.</span><span class="n">unpack_x_y</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>                    <span class="n">callbacks</span><span class="o">.</span><span class="n">on_train_batch_begin</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>                    <span class="n">logs</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_on_batch</span><span class="p">(</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>                        <span class="n">x</span><span class="o">=</span><span class="n">x_batch</span><span class="p">,</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>                        <span class="n">y</span><span class="o">=</span><span class="n">y_batch</span><span class="p">,</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>                        <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>                    <span class="p">)</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>                    <span class="n">callbacks</span><span class="o">.</span><span class="n">on_train_batch_end</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">logs</span><span class="p">)</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_training</span><span class="p">:</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>                        <span class="k">break</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>            <span class="c1"># Override with model metrics instead of last step logs if needed.</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>            <span class="n">epoch_logs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_metrics_result_or_logs</span><span class="p">(</span><span class="n">logs</span><span class="p">))</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>            <span class="c1"># Run validation.</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>            <span class="k">if</span> <span class="n">validation_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_eval</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">validation_freq</span><span class="p">):</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>                <span class="c1"># Create EpochIterator for evaluation and cache it.</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_eval_epoch_iterator&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_eval_epoch_iterator</span> <span class="o">=</span> <span class="n">EpochIterator</span><span class="p">(</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>                        <span class="n">x</span><span class="o">=</span><span class="n">val_x</span><span class="p">,</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>                        <span class="n">y</span><span class="o">=</span><span class="n">val_y</span><span class="p">,</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>                        <span class="n">batch_size</span><span class="o">=</span><span class="n">validation_batch_size</span> <span class="ow">or</span> <span class="n">batch_size</span><span class="p">,</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>                        <span class="n">steps_per_execution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">steps_per_execution</span><span class="p">,</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>                        <span class="n">steps_per_epoch</span><span class="o">=</span><span class="n">validation_steps</span><span class="p">,</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>                        <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>                    <span class="p">)</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>                <span class="n">val_logs</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>                    <span class="n">x</span><span class="o">=</span><span class="n">val_x</span><span class="p">,</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>                    <span class="n">y</span><span class="o">=</span><span class="n">val_y</span><span class="p">,</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>                    <span class="n">batch_size</span><span class="o">=</span><span class="n">validation_batch_size</span> <span class="ow">or</span> <span class="n">batch_size</span><span class="p">,</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>                    <span class="n">steps</span><span class="o">=</span><span class="n">validation_steps</span><span class="p">,</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>                    <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">,</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>                    <span class="n">_use_cached_eval_dataset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>                <span class="p">)</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>                <span class="n">val_logs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;val_&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">:</span> <span class="n">val</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">val_logs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>                <span class="n">epoch_logs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">val_logs</span><span class="p">)</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>            <span class="n">callbacks</span><span class="o">.</span><span class="n">on_epoch_end</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">epoch_logs</span><span class="p">)</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>            <span class="n">training_logs</span> <span class="o">=</span> <span class="n">epoch_logs</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_training</span><span class="p">:</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>                <span class="k">break</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">optimizers_module</span><span class="o">.</span><span class="n">Optimizer</span><span class="p">)</span> <span class="ow">and</span> <span class="n">epochs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">finalize_variable_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainable_variables</span><span class="p">)</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>        <span class="c1"># If _eval_epoch_iterator exists, delete it after all epochs are done.</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_eval_epoch_iterator&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_epoch_iterator</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>        <span class="n">callbacks</span><span class="o">.</span><span class="n">on_train_end</span><span class="p">(</span><span class="n">logs</span><span class="o">=</span><span class="n">training_logs</span><span class="p">)</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>        <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>        <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>        <span class="n">batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>        <span class="n">verbose</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>        <span class="n">steps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>        <span class="n">callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>        <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>    <span class="p">):</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the reward value &amp; metrics values for the program in test mode.</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a><span class="sd">        Computation is done in batches (see the `batch_size` arg.)</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a><span class="sd">            x (np.ndarray | generator): Input data. It can be:</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a><span class="sd">                - A NumPy array (or array-like), or a list of `DataModel` arrays</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a><span class="sd">                    (in case the model has multiple inputs).</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a><span class="sd">                - A list of dict mapping input names to the corresponding `DataModel`s,</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a><span class="sd">                    if the program has named inputs.</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a><span class="sd">                - A Python generator function yielding `(inputs, targets)`.</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a><span class="sd">            y (np.ndarray): Target data. Like the input data `x`, it can be either NumPy</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a><span class="sd">                array(s) of `DataModel`(s). If `x` is a Python generator function,</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">                `y` should not be specified since targets will be obtained from</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a><span class="sd">                `x`.</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a><span class="sd">            batch_size (int): Integer or `None`.</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a><span class="sd">                Number of samples per batch of computation.</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a><span class="sd">                If unspecified, `batch_size` will default to 32.</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a><span class="sd">                Do not specify the `batch_size` if your input data `x` is a</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a><span class="sd">                Python generator function since they generate batches.</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="sd">            verbose (int | str): `&quot;auto&quot;`, 0, 1, or 2. Verbosity mode.</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="sd">                0 = silent, 1 = progress bar, 2 = single line.</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">                `&quot;auto&quot;` becomes 1 for most cases.</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a><span class="sd">                Note that the progress bar is not</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a><span class="sd">                particularly useful when logged to a file, so `verbose=2` is</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="sd">                recommended when not running interactively</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a><span class="sd">                (e.g. in a production environment). Defaults to `&quot;auto&quot;`.</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a><span class="sd">            steps (int): Integer or `None`.</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a><span class="sd">                Total number of steps (batches of samples) to draw before</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a><span class="sd">                declaring the evaluation round finished. If `steps` is `None`,</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a><span class="sd">                it will run until `x` is exhausted. In the case of an infinitely</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a><span class="sd">                repeating dataset, it will run indefinitely.</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a><span class="sd">            callbacks (list): List of `synalinks.callbacks.Callback` instances.</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a><span class="sd">                List of callbacks to apply during evaluation.</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a><span class="sd">            return_dict (bool): If `True`, reward and metric results are returned as a</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a><span class="sd">                dict, with each key being the name of the metric.</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a><span class="sd">                If `False`, they are returned as a list.</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a><span class="sd">            (float | list | dict): Scalar test reward</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a><span class="sd">                (if the program has a single output and no metrics)</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a><span class="sd">                or list of scalars (if the program has multiple outputs</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a><span class="sd">                and/or metrics). The attribute `program.metrics_names` will give you</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a><span class="sd">                the display labels for the scalar outputs.</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_compile_called</span><span class="p">(</span><span class="s2">&quot;evaluate&quot;</span><span class="p">)</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>        <span class="n">use_cached_eval_dataset</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;_use_cached_eval_dataset&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arguments not recognized: </span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>        <span class="c1"># Create an iterator that yields batches of input/target data.</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>        <span class="k">if</span> <span class="n">use_cached_eval_dataset</span><span class="p">:</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>            <span class="n">epoch_iterator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_epoch_iterator</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>            <span class="n">epoch_iterator</span> <span class="o">=</span> <span class="n">EpochIterator</span><span class="p">(</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>                <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>                <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>                <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>                <span class="n">steps_per_epoch</span><span class="o">=</span><span class="n">steps</span><span class="p">,</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>                <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>                <span class="n">steps_per_execution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">steps_per_execution</span><span class="p">,</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>            <span class="p">)</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">built</span> <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten_modules</span><span class="p">()):</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>            <span class="c1"># Build the model on one batch of data.</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">epoch_iterator</span><span class="p">:</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>                <span class="n">data_batch</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_auto_build</span><span class="p">(</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>                    <span class="n">iterator</span><span class="o">=</span><span class="n">epoch_iterator</span><span class="p">,</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>                    <span class="n">data_batch</span><span class="o">=</span><span class="n">data_batch</span><span class="p">,</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>                <span class="p">)</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>                <span class="k">break</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>        <span class="n">epoch_iterator</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>        <span class="c1"># Container that configures and calls callbacks.</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">callbacks</span><span class="p">,</span> <span class="n">callbacks_module</span><span class="o">.</span><span class="n">CallbackList</span><span class="p">):</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>            <span class="n">callbacks</span> <span class="o">=</span> <span class="n">callbacks_module</span><span class="o">.</span><span class="n">CallbackList</span><span class="p">(</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>                <span class="n">callbacks</span><span class="p">,</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>                <span class="n">add_history</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>                <span class="n">add_progbar</span><span class="o">=</span><span class="n">verbose</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>                <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>                <span class="n">steps</span><span class="o">=</span><span class="n">epoch_iterator</span><span class="o">.</span><span class="n">num_batches</span><span class="p">,</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>                <span class="n">program</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>            <span class="p">)</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stop_evaluating</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>        <span class="n">callbacks</span><span class="o">.</span><span class="n">on_test_begin</span><span class="p">()</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>        <span class="n">logs</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reset_metrics</span><span class="p">()</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>        <span class="k">for</span> <span class="n">step</span><span class="p">,</span> <span class="n">iterator</span> <span class="ow">in</span> <span class="n">epoch_iterator</span><span class="p">:</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>            <span class="n">callbacks</span><span class="o">.</span><span class="n">on_test_batch_begin</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">iterator</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>            <span class="n">x_batch</span><span class="p">,</span> <span class="n">y_batch</span> <span class="o">=</span> <span class="n">data_adapter_utils</span><span class="o">.</span><span class="n">unpack_x_y</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>            <span class="n">logs</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_on_batch</span><span class="p">(</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>                <span class="n">x</span><span class="o">=</span><span class="n">x_batch</span><span class="p">,</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>                <span class="n">y</span><span class="o">=</span><span class="n">y_batch</span><span class="p">,</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>                <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>            <span class="p">)</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>            <span class="n">callbacks</span><span class="o">.</span><span class="n">on_test_batch_end</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">logs</span><span class="p">)</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_evaluating</span><span class="p">:</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>                <span class="k">break</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>        <span class="n">logs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_metrics_result_or_logs</span><span class="p">(</span><span class="n">logs</span><span class="p">)</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>        <span class="n">callbacks</span><span class="o">.</span><span class="n">on_test_end</span><span class="p">(</span><span class="n">logs</span><span class="p">)</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>        <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>            <span class="k">return</span> <span class="n">logs</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten_metrics_in_order</span><span class="p">(</span><span class="n">logs</span><span class="p">)</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="kc">None</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>    <span class="p">):</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates output predictions for the input samples.</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a><span class="sd">        Computation is done in batches. This method is designed for batch</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a><span class="sd">        processing of large numbers of inputs. It is not intended for use inside</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="sd">        of loops that iterate over your data and process small numbers of inputs</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="sd">        at a time.</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a><span class="sd">        For small numbers of inputs that fit in one batch,</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a><span class="sd">        directly use `__call__()` for faster execution, e.g.,</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a><span class="sd">        `program(x)`, or `program(x, training=False)` if you have modules</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a><span class="sd">        that behave differently during inference.</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a><span class="sd">            x (np.ndarray | generator): Input data. It can be:</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a><span class="sd">                - A NumPy array (or array-like), or a list of `DataModel` arrays</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a><span class="sd">                    (in case the model has multiple inputs).</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a><span class="sd">                - A list of dict mapping input names to the corresponding `DataModel`s,</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a><span class="sd">                    if the program has named inputs.</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a><span class="sd">                - A Python generator function yielding `(inputs, targets)`.</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a><span class="sd">            batch_size (int): Integer or `None`.</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a><span class="sd">                Number of samples per batch of computation.</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a><span class="sd">                If unspecified, `batch_size` will default to 32.</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a><span class="sd">                Do not specify the `batch_size` if your input data `x` is a</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a><span class="sd">                `synalinks.utils.PyDataset`, `tf.data.Dataset`,</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a><span class="sd">                `torch.utils.data.DataLoader` or Python generator function</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a><span class="sd">                since they generate batches.</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a><span class="sd">            verbose (int): `&quot;auto&quot;`, 0, 1, or 2. Verbosity mode.</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a><span class="sd">                0 = silent, 1 = progress bar, 2 = single line.</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a><span class="sd">                `&quot;auto&quot;` becomes 1 for most cases. Note that the progress bar</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a><span class="sd">                is not particularly useful when logged to a file,</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a><span class="sd">                so `verbose=2` is recommended when not running interactively</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a><span class="sd">                (e.g. in a production environment). Defaults to `&quot;auto&quot;`.</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a><span class="sd">            steps (int): Total number of steps (batches of samples) to draw before</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a><span class="sd">                declaring the prediction round finished. If `steps` is `None`,</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a><span class="sd">                it will run until `x` is exhausted. In the case of an infinitely</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a><span class="sd">                repeating dataset, it will run indefinitely.</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a><span class="sd">            callbacks (list): List of `synalinks.callbacks.Callback` instances.</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a><span class="sd">                List of callbacks to apply during prediction.</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a><span class="sd">            (list): `JsonDataModel` array(s) of predictions.</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a><span class="sd">                If the pipeline failed, a None is added to the predictions.</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>        <span class="c1"># Create an iterator that yields batches of input data.</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>        <span class="n">epoch_iterator</span> <span class="o">=</span> <span class="n">EpochIterator</span><span class="p">(</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>            <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>            <span class="n">steps_per_epoch</span><span class="o">=</span><span class="n">steps</span><span class="p">,</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>            <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>            <span class="n">steps_per_execution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">steps_per_execution</span><span class="p">,</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>        <span class="p">)</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>        <span class="c1"># Container that configures and calls callbacks.</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">callbacks</span><span class="p">,</span> <span class="n">callbacks_module</span><span class="o">.</span><span class="n">CallbackList</span><span class="p">):</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>            <span class="n">callbacks</span> <span class="o">=</span> <span class="n">callbacks_module</span><span class="o">.</span><span class="n">CallbackList</span><span class="p">(</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>                <span class="n">callbacks</span><span class="p">,</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>                <span class="n">add_history</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>                <span class="n">add_progbar</span><span class="o">=</span><span class="n">verbose</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>                <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>                <span class="n">steps</span><span class="o">=</span><span class="n">epoch_iterator</span><span class="o">.</span><span class="n">num_batches</span><span class="p">,</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>                <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>            <span class="p">)</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stop_predicting</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>        <span class="n">callbacks</span><span class="o">.</span><span class="n">on_test_begin</span><span class="p">()</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>        <span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>        <span class="k">for</span> <span class="n">step</span><span class="p">,</span> <span class="n">iterator</span> <span class="ow">in</span> <span class="n">epoch_iterator</span><span class="p">:</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>            <span class="n">callbacks</span><span class="o">.</span><span class="n">on_predict_batch_begin</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">iterator</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>            <span class="n">x_batch</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">data_adapter_utils</span><span class="o">.</span><span class="n">unpack_x_y</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>            <span class="n">batch_outputs</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_on_batch</span><span class="p">(</span><span class="n">x_batch</span><span class="p">)</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>            <span class="n">outputs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">batch_outputs</span><span class="p">)</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>            <span class="n">callbacks</span><span class="o">.</span><span class="n">on_predict_batch_end</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="n">batch_outputs</span><span class="p">})</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_predicting</span><span class="p">:</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>                <span class="k">break</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>        <span class="n">callbacks</span><span class="o">.</span><span class="n">on_predict_end</span><span class="p">()</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">)</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">train_on_batch</span><span class="p">(</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>        <span class="n">x</span><span class="p">,</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>        <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>        <span class="n">return_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>    <span class="p">):</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Runs a single backpropagation/optimization update on a single batch of data.</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a><span class="sd">            x (np.ndarray): Input data. Must be array-like.</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a><span class="sd">            y (np.ndarray): Target data. Must be array-like.</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a><span class="sd">            return_dict (bool): If `True`, reward and metric results are returned as a</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a><span class="sd">                dict, with each key being the name of the metric. If `False`,</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a><span class="sd">                they are returned as a list.</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a><span class="sd">            (float | list | dict): A scalar reward value</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a><span class="sd">                (when no metrics and `return_dict=False`), a list of reward</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a><span class="sd">                and metric values (if there are metrics and `return_dict=False`),</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a><span class="sd">                or a dict of metric and reward values (if `return_dict=True`).</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>        <span class="n">y_pred</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_on_batch</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>        <span class="n">reward</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_reward</span><span class="p">(</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>            <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>            <span class="n">y_pred</span><span class="o">=</span><span class="n">y_pred</span><span class="p">,</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>            <span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>        <span class="p">)</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reward_tracker</span><span class="o">.</span><span class="n">update_state</span><span class="p">(</span><span class="n">reward</span><span class="p">)</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>        <span class="c1"># Perform training/optimization</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainable_variables</span><span class="p">:</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">apply_optimization</span><span class="p">(</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">trainable_variables</span><span class="p">,</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>                <span class="n">reward</span><span class="o">=</span><span class="n">reward</span><span class="p">,</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>            <span class="p">)</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;The program does not have any trainable variables.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>        <span class="n">metrics</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_metrics</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>        <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>            <span class="k">return</span> <span class="n">metrics</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten_metrics_in_order</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_on_batch</span><span class="p">(</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>        <span class="n">x</span><span class="p">,</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>        <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>        <span class="n">return_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>    <span class="p">):</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test the program on a single batch of samples.</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a><span class="sd">            x (np.ndarray): Input data. Must be array-like.</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a><span class="sd">            y (np.ndarray): Target data. Must be array-like.</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a><span class="sd">            return_dict (bool): If `True`, reward and metric results are returned as a</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a><span class="sd">                dict, with each key being the name of the metric. If `False`,</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a><span class="sd">                they are returned as a list.</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a><span class="sd">            (float | list | dict): A scalar reward value</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a><span class="sd">                (when no metrics and `return_dict=False`), a list of reward</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a><span class="sd">                and metric values (if there are metrics and `return_dict=False`),</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a><span class="sd">                or a dict of metric and reward values (if `return_dict=True`).</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>        <span class="n">y_pred</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_on_batch</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>        <span class="n">reward</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_reward</span><span class="p">(</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>            <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>            <span class="n">y_pred</span><span class="o">=</span><span class="n">y_pred</span><span class="p">,</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>            <span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>        <span class="p">)</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reward_tracker</span><span class="o">.</span><span class="n">update_state</span><span class="p">(</span><span class="n">reward</span><span class="p">)</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>        <span class="n">metrics</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_metrics</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>        <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>            <span class="k">return</span> <span class="n">metrics</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten_metrics_in_order</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">predict_on_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns predictions for a single batch of samples.</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a><span class="sd">            x (np.ndarray): Input data. Must be array-like.</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a><span class="sd">            training (bool): Boolean. True if training.</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a><span class="sd">            (list): list(s) of JsonDataModel predictions.</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>        <span class="k">for</span> <span class="n">inputs</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>            <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="n">training</span><span class="p">))</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>        <span class="n">y_pred</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>        <span class="k">return</span> <span class="n">y_pred</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_compile_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a serialized config with information for compiling the program.</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a><span class="sd">        This method returns a config dictionary containing all the information</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a><span class="sd">        (optimizer, reward, metrics, etc.) with which the program was compiled.</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a><span class="sd">            (dict): A dict containing information for compiling the program.</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiled</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_compile_config&quot;</span><span class="p">):</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_config</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compile_from_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compiles the program with the information given in config.</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a><span class="sd">        This method uses the information in the config (optimizer, reward,</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a><span class="sd">        metrics, etc.) to compile the program.</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a><span class="sd">            config (dict): Dict containing information for compiling the program.</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>        <span class="n">has_overridden_compile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">compile</span> <span class="o">!=</span> <span class="n">Trainer</span><span class="o">.</span><span class="n">compile</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>        <span class="k">if</span> <span class="n">has_overridden_compile</span><span class="p">:</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>                <span class="s2">&quot;`compile()` was not called as part of program loading &quot;</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>                <span class="s2">&quot;because the program&#39;s `compile()` method is custom. &quot;</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>                <span class="s2">&quot;All subclassed Models that have `compile()` &quot;</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>                <span class="s2">&quot;overridden should also override &quot;</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>                <span class="s2">&quot;`get_compile_config()` and `compile_from_config(config)`. &quot;</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>                <span class="s2">&quot;Alternatively, you can &quot;</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>                <span class="s2">&quot;call `compile()` manually after loading.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>            <span class="p">)</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>            <span class="k">return</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>        <span class="n">config</span> <span class="o">=</span> <span class="n">serialization_lib</span><span class="o">.</span><span class="n">deserialize_synalinks_object</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="o">**</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;optimizer&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">built</span><span class="p">:</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>            <span class="c1"># Create optimizer variables/programs.</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">built</span><span class="p">:</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>                <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainable_variables</span><span class="p">)</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>                <span class="p">)</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_should_reward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">validation_freq</span><span class="p">):</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a>        <span class="n">epoch</span> <span class="o">=</span> <span class="n">epoch</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># one-index the user-facing epoch.</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">validation_freq</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>            <span class="k">return</span> <span class="n">epoch</span> <span class="o">%</span> <span class="n">validation_freq</span> <span class="o">==</span> <span class="mi">0</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">validation_freq</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>            <span class="k">return</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="n">validation_freq</span>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>                <span class="s2">&quot;Expected `validation_freq` to be a list or int. &quot;</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>                <span class="sa">f</span><span class="s2">&quot;Received: validation_freq=</span><span class="si">{</span><span class="n">validation_freq</span><span class="si">}</span><span class="s2"> of the &quot;</span>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>                <span class="sa">f</span><span class="s2">&quot;type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">validation_freq</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>            <span class="p">)</span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_metrics_result_or_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logs</span><span class="p">):</span>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns program metrics as a dict if the keys match with input logs.</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a><span class="sd">        When the training / evaluation is performed with an asynchronous steps,</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a><span class="sd">        the last scheduled `train / test_step` may not give the latest metrics</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a><span class="sd">        because it is not guaranteed to be executed the last. This method gets</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a><span class="sd">        metrics from the program directly instead of relying on the return from</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a><span class="sd">        last step function.</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a><span class="sd">        When the user has custom train / test step functions, the metrics</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a><span class="sd">        returned may be different from `Program.metrics`. In those instances,</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a><span class="sd">        this function will be no-op and return the logs passed in.</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a><span class="sd">            logs (dict): A `dict` of metrics returned by train / test step function.</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a><span class="sd">            (dict): A `dict` containing values of the metrics listed in `self.metrics`</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a><span class="sd">                when logs and program metrics keys match. Otherwise it returns input</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a><span class="sd">                `logs`.</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>        <span class="n">metric_logs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_metrics_result</span><span class="p">()</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>        <span class="c1"># Verify that train / test step logs passed and metric logs have</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>        <span class="c1"># matching keys. It could be different when using custom step functions,</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>        <span class="c1"># in which case we return the logs from the last step.</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">logs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">set</span><span class="p">(</span><span class="n">logs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">metric_logs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a>            <span class="k">return</span> <span class="n">metric_logs</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a>        <span class="k">return</span> <span class="n">logs</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_flatten_metrics_in_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logs</span><span class="p">):</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Turns `logs` dict into a list as per key order of `metrics_names`.&quot;&quot;&quot;</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>        <span class="n">metric_names</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>        <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">:</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">CompileMetrics</span><span class="p">):</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>                <span class="n">metric_names</span> <span class="o">+=</span> <span class="p">[</span><span class="n">sub_metric</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">sub_metric</span> <span class="ow">in</span> <span class="n">metric</span><span class="o">.</span><span class="n">metrics</span><span class="p">]</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>                <span class="n">metric_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metric</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">metric_names</span><span class="p">:</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">logs</span><span class="p">:</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">logs</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">logs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metric_names</span><span class="p">:</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">logs</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>            <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>        <span class="k">return</span> <span class="n">results</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_assert_compile_called</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiled</span><span class="p">:</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;You must call `compile()` before &quot;</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>            <span class="k">if</span> <span class="n">metrics_module</span><span class="p">:</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;using the program.&quot;</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;calling `</span><span class="si">{</span><span class="n">method_name</span><span class="si">}</span><span class="s2">()`.&quot;</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_auto_build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_batch</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>        <span class="n">program_unbuilt</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">built</span> <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten_modules</span><span class="p">())</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>        <span class="n">compile_metrics_unbuilt</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_compile_metrics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_metrics</span><span class="o">.</span><span class="n">built</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>        <span class="p">)</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>        <span class="n">compile_reward_unbuilt</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_compile_reward</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_reward</span><span class="o">.</span><span class="n">built</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>        <span class="p">)</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>        <span class="n">optimizer_unbuilt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">built</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>        <span class="k">if</span> <span class="n">program_unbuilt</span> <span class="ow">or</span> <span class="n">compile_metrics_unbuilt</span> <span class="ow">or</span> <span class="n">compile_reward_unbuilt</span><span class="p">:</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>            <span class="k">if</span> <span class="n">data_batch</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>                <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">data_or_iterator</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_or_iterator</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>                        <span class="n">data_batch</span> <span class="o">=</span> <span class="n">data_or_iterator</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>                        <span class="n">data_batch</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">data_or_iterator</span><span class="p">)</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>                    <span class="k">break</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>            <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="n">data_batch</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>                <span class="n">y_pred</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">predict_on_batch</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>                <span class="p">)</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>                    <span class="s2">&quot;Unable to automatically build the program. &quot;</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>                    <span class="s2">&quot;Please build it yourself before calling &quot;</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>                    <span class="s2">&quot;fit/evaluate/predict. &quot;</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>                    <span class="s2">&quot;A program is &#39;built&#39; when its variables have &quot;</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>                    <span class="s2">&quot;been created and its `self.built` attribute &quot;</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>                    <span class="s2">&quot;is True. Usually, calling the program on a batch &quot;</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>                    <span class="s2">&quot;of data is the right way to build it.</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>                    <span class="s2">&quot;Exception encountered:</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>                    <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>                <span class="p">)</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>            <span class="k">if</span> <span class="n">compile_metrics_unbuilt</span><span class="p">:</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>                <span class="c1"># Build all metric state with `backend.compute_output_spec`.</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>                <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>                    <span class="n">backend</span><span class="o">.</span><span class="n">compute_output_spec</span><span class="p">(</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">compute_metrics</span><span class="p">,</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>                        <span class="n">x</span><span class="p">,</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>                        <span class="n">y</span><span class="p">,</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>                        <span class="n">y_pred</span><span class="p">,</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>                <span class="p">)</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>            <span class="k">if</span> <span class="n">compile_reward_unbuilt</span><span class="p">:</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>                <span class="c1"># Build `CompileReward` state with `backend.compute_output_spec`.</span>
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>                <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>                    <span class="n">backend</span><span class="o">.</span><span class="n">compute_output_spec</span><span class="p">(</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">compute_reward</span><span class="p">,</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>                        <span class="n">x</span><span class="p">,</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>                        <span class="n">y</span><span class="p">,</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>                        <span class="n">y_pred</span><span class="p">,</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>                        <span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>                <span class="p">)</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>        <span class="k">if</span> <span class="n">optimizer_unbuilt</span><span class="p">:</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>            <span class="c1"># Build optimizer</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>            <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainable_variables</span><span class="p">)</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>            <span class="p">)</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_post_build</span><span class="p">()</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_assert_compile_called</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiled</span><span class="p">:</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;You must call `compile()` before &quot;</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>            <span class="k">if</span> <span class="n">metrics_module</span><span class="p">:</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;using the model.&quot;</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a>                <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;calling `</span><span class="si">{</span><span class="n">method_name</span><span class="si">}</span><span class="s2">()`.&quot;</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_should_eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">validation_freq</span><span class="p">):</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>        <span class="n">epoch</span> <span class="o">=</span> <span class="n">epoch</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># one-index the user-facing epoch.</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">validation_freq</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>            <span class="k">return</span> <span class="n">epoch</span> <span class="o">%</span> <span class="n">validation_freq</span> <span class="o">==</span> <span class="mi">0</span>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">validation_freq</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>            <span class="k">return</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="n">validation_freq</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>                <span class="s2">&quot;Expected `validation_freq` to be a list or int. &quot;</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a>                <span class="sa">f</span><span class="s2">&quot;Received: validation_freq=</span><span class="si">{</span><span class="n">validation_freq</span><span class="si">}</span><span class="s2"> of the &quot;</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a>                <span class="sa">f</span><span class="s2">&quot;type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">validation_freq</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="synalinks.src.trainers.trainer.Trainer.compile" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reward</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reward_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">run_eagerly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">steps_per_execution</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Configures the program for training.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">program</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="n">optimizer</span><span class="o">=</span><span class="n">synalinks</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">RandomFewShot</span><span class="p">(),</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="n">reward</span><span class="o">=</span><span class="n">synalinks</span><span class="o">.</span><span class="n">rewards</span><span class="o">.</span><span class="n">ExactMatch</span><span class="p">(),</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>        <span class="n">synalinks</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MeanMetricWrapper</span><span class="p">(</span><span class="n">synalinks</span><span class="o">.</span><span class="n">rewards</span><span class="o">.</span><span class="n">exact_match</span><span class="p">),</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="p">],</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="p">)</span>
</code></pre></div>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>optimizer</code>
            </td>
            <td>
                  <code><span title="Optimizer">Optimizer</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optimizer instance. See <code>synalinks.optimizers</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reward</code>
            </td>
            <td>
                  <code><span title="synalinks.api.Reward">Reward</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reward function. A <code>synalinks.rewards.Reward</code>
instance. See <code>synalinks.rewards</code>. A reward function is
any callable with the signature <code>reward = fn(y_true, y_pred)</code>,
where <code>y_true</code> are the ground truth values, and <code>y_pred</code>
are the program's predictions.
<code>y_true</code> should be a list of batch size length <code>[d0, .. dN]</code>.
<code>y_pred</code> should be a list of batch size length <code>[d0, .. dN]</code>.
The reward function should return a float.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reward_weights</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional list specifying scalar coefficients
(Python floats) to weight the reward contributions of
different program outputs. The reward value that will be maximized
by the program will then be the <em>weighted sum</em> of all individual
rewards, weighted by the <code>reward_weights</code> coefficients. It is
expected to have a 1:1 mapping to the program's outputs.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metrics</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of metrics to be evaluated by the program during
training and testing. Each of it is a <code>synalinks.metrics.Metric</code>
instance. See <code>synalinks.metrics</code>. A function is any callable with the
signature <code>result = fn(y_true, y_pred)</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>run_eagerly</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, this program's forward pass
 will never be compiled. It is recommended to leave this
 as <code>False</code> when training (for best performance),
 and to set it to <code>True</code> when debugging.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>steps_per_execution</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of batches to run
during each a single compiled function call. Running multiple
batches inside a single compiled function call can
greatly improve performance on TPUs or small programs with a large
Python overhead. At most, one full epoch will be run each
execution. If a number larger than the size of the epoch is
passed, the execution will be truncated to the size of the
epoch. Note that if <code>steps_per_execution</code> is set to <code>N</code>,
<code>Callback.on_batch_begin</code> and <code>Callback.on_batch_end</code> methods
will only be called every <code>N</code> batches (i.e. before/after
each compiled function execution).</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>synalinks/src/trainers/trainer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="nd">@tracking</span><span class="o">.</span><span class="n">no_automatic_dependency_tracking</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="k">def</span><span class="w"> </span><span class="nf">compile</span><span class="p">(</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="n">optimizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="n">reward</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="n">reward_weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="n">metrics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="n">run_eagerly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="n">steps_per_execution</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="p">):</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Configures the program for training.</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    ```python</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    program.compile(</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        optimizer=synalinks.optimizers.RandomFewShot(),</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        reward=synalinks.rewards.ExactMatch(),</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">        metrics=[</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">            synalinks.metrics.MeanMetricWrapper(synalinks.rewards.exact_match),</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        ],</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    )</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">    ```</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">        optimizer (Optimizer): Optimizer instance. See `synalinks.optimizers`.</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">        reward (Reward): Reward function. A `synalinks.rewards.Reward`</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">            instance. See `synalinks.rewards`. A reward function is</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">            any callable with the signature `reward = fn(y_true, y_pred)`,</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">            where `y_true` are the ground truth values, and `y_pred`</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">            are the program&#39;s predictions.</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">            `y_true` should be a list of batch size length `[d0, .. dN]`.</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">            `y_pred` should be a list of batch size length `[d0, .. dN]`.</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">            The reward function should return a float.</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        reward_weights (list): Optional list specifying scalar coefficients</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">            (Python floats) to weight the reward contributions of</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">            different program outputs. The reward value that will be maximized</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">            by the program will then be the *weighted sum* of all individual</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">            rewards, weighted by the `reward_weights` coefficients. It is</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">            expected to have a 1:1 mapping to the program&#39;s outputs.</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        metrics (list): List of metrics to be evaluated by the program during</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">            training and testing. Each of it is a `synalinks.metrics.Metric`</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">            instance. See `synalinks.metrics`. A function is any callable with the</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">            signature `result = fn(y_true, y_pred)`.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        run_eagerly (bool): If `True`, this program&#39;s forward pass</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">             will never be compiled. It is recommended to leave this</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">             as `False` when training (for best performance),</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">             and to set it to `True` when debugging.</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">        steps_per_execution (int): The number of batches to run</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">            during each a single compiled function call. Running multiple</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">            batches inside a single compiled function call can</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">            greatly improve performance on TPUs or small programs with a large</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">            Python overhead. At most, one full epoch will be run each</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">            execution. If a number larger than the size of the epoch is</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">            passed, the execution will be truncated to the size of the</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">            epoch. Note that if `steps_per_execution` is set to `N`,</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">            `Callback.on_batch_begin` and `Callback.on_batch_end` methods</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">            will only be called every `N` batches (i.e. before/after</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">            each compiled function execution).</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_clear_previous_trainer_metrics</span><span class="p">()</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_optimizer</span> <span class="o">=</span> <span class="n">optimizer</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;output_names&quot;</span><span class="p">):</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="n">output_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_names</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="n">output_names</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="k">if</span> <span class="n">reward</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_compile_reward</span> <span class="o">=</span> <span class="n">CompileReward</span><span class="p">(</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>            <span class="n">reward</span><span class="p">,</span> <span class="n">reward_weights</span><span class="p">,</span> <span class="n">output_names</span><span class="o">=</span><span class="n">output_names</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="p">)</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reward</span> <span class="o">=</span> <span class="n">reward</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="k">if</span> <span class="n">metrics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_compile_metrics</span> <span class="o">=</span> <span class="n">CompileMetrics</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">output_names</span><span class="o">=</span><span class="n">output_names</span><span class="p">)</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">run_eagerly</span> <span class="o">=</span> <span class="n">run_eagerly</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">stop_training</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">compiled</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_reward_tracker</span> <span class="o">=</span> <span class="n">metrics_module</span><span class="o">.</span><span class="n">Mean</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;reward&quot;</span><span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">steps_per_execution</span> <span class="o">=</span> <span class="n">steps_per_execution</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_compile_config</span> <span class="o">=</span> <span class="n">serialization_lib</span><span class="o">.</span><span class="n">SerializableDict</span><span class="p">(</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="n">reward</span><span class="o">=</span><span class="n">reward</span><span class="p">,</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="n">reward_weights</span><span class="o">=</span><span class="n">reward_weights</span><span class="p">,</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">,</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="n">run_eagerly</span><span class="o">=</span><span class="n">run_eagerly</span><span class="p">,</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="n">steps_per_execution</span><span class="o">=</span><span class="n">steps_per_execution</span><span class="p">,</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="synalinks.src.trainers.trainer.Trainer.compile_from_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compile_from_config</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Compiles the program with the information given in config.</p>
<p>This method uses the information in the config (optimizer, reward,
metrics, etc.) to compile the program.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict containing information for compiling the program.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>synalinks/src/trainers/trainer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span>
<span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span>
<span class="normal"><a href="#__codelineno-0-883">883</a></span>
<span class="normal"><a href="#__codelineno-0-884">884</a></span>
<span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span>
<span class="normal"><a href="#__codelineno-0-890">890</a></span>
<span class="normal"><a href="#__codelineno-0-891">891</a></span>
<span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span>
<span class="normal"><a href="#__codelineno-0-894">894</a></span>
<span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span>
<span class="normal"><a href="#__codelineno-0-900">900</a></span>
<span class="normal"><a href="#__codelineno-0-901">901</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-872" name="__codelineno-0-872"></a><span class="k">def</span><span class="w"> </span><span class="nf">compile_from_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compiles the program with the information given in config.</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a><span class="sd">    This method uses the information in the config (optimizer, reward,</span>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a><span class="sd">    metrics, etc.) to compile the program.</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a><span class="sd">        config (dict): Dict containing information for compiling the program.</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>    <span class="n">has_overridden_compile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">compile</span> <span class="o">!=</span> <span class="n">Trainer</span><span class="o">.</span><span class="n">compile</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>    <span class="k">if</span> <span class="n">has_overridden_compile</span><span class="p">:</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>            <span class="s2">&quot;`compile()` was not called as part of program loading &quot;</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>            <span class="s2">&quot;because the program&#39;s `compile()` method is custom. &quot;</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>            <span class="s2">&quot;All subclassed Models that have `compile()` &quot;</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>            <span class="s2">&quot;overridden should also override &quot;</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>            <span class="s2">&quot;`get_compile_config()` and `compile_from_config(config)`. &quot;</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>            <span class="s2">&quot;Alternatively, you can &quot;</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>            <span class="s2">&quot;call `compile()` manually after loading.&quot;</span><span class="p">,</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>        <span class="p">)</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>        <span class="k">return</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>    <span class="n">config</span> <span class="o">=</span> <span class="n">serialization_lib</span><span class="o">.</span><span class="n">deserialize_synalinks_object</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="o">**</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;optimizer&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">built</span><span class="p">:</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>        <span class="c1"># Create optimizer variables/programs.</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">built</span><span class="p">:</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>            <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainable_variables</span><span class="p">)</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="synalinks.src.trainers.trainer.Trainer.compute_metrics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_metrics</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Update metric states and collect all metrics to be returned.</p>
<p>Subclasses can optionally override this method to provide custom metric
updating and collection logic. Custom metrics are not passed in
<code>compile()</code>, they can be created in <code>__init__</code> or <code>build</code>. They are
automatically tracked and returned by <code>self.metrics</code>.
```</p>
<p>Args:
    x: Input data.
    y: Target data.
    y_pred: Predictions returned by the program output of <code>program.call(x)</code>.</p>
<p>Returns:
    A <code>dict</code> containing values that will be passed to
        <code>synalinks.callbacks.CallbackList.on_train_batch_end()</code>. Typically,
        the values of the metrics listed in <code>self.metrics</code> are returned.
        Example: <code>{'reward': 0.2, 'accuracy': 0.7}</code>.</p>


            <details class="quote">
              <summary>Source code in <code>synalinks/src/trainers/trainer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">compute_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Update metric states and collect all metrics to be returned.</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">    Subclasses can optionally override this method to provide custom metric</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">    updating and collection logic. Custom metrics are not passed in</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">    `compile()`, they can be created in `__init__` or `build`. They are</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">    automatically tracked and returned by `self.metrics`.</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">    ```</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">        x: Input data.</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">        y: Target data.</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">        y_pred: Predictions returned by the program output of `program.call(x)`.</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">        A `dict` containing values that will be passed to</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="sd">            `synalinks.callbacks.CallbackList.on_train_batch_end()`. Typically,</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="sd">            the values of the metrics listed in `self.metrics` are returned.</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">            Example: `{&#39;reward&#39;: 0.2, &#39;accuracy&#39;: 0.7}`.</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>    <span class="k">del</span> <span class="n">x</span>  <span class="c1"># The default implementation does not use `x`.</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_metrics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>        <span class="k">for</span> <span class="n">y_t</span><span class="p">,</span> <span class="n">y_p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_metrics</span><span class="o">.</span><span class="n">update_state</span><span class="p">(</span><span class="n">y_t</span><span class="p">,</span> <span class="n">y_p</span><span class="p">)</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_metrics_result</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="synalinks.src.trainers.trainer.Trainer.compute_reward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_reward</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_pred</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Compute the total reward, validate it, and return it.</p>
<p>Subclasses can optionally override this method to provide custom reward
computation logic.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input data.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target data.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y_pred</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Predictions returned by the program (output of <code>program(x)</code>).</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>training</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether we are training or evaluating the program.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total reward as a scalar, or <code>None</code> if no reward results
(which is the case when called by <code>Program.test_step</code>).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>synalinks/src/trainers/trainer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">compute_reward</span><span class="p">(</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>    <span class="n">y_pred</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>    <span class="n">sample_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>    <span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="p">):</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the total reward, validate it, and return it.</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">    Subclasses can optionally override this method to provide custom reward</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">    computation logic.</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">        x (list): Input data.</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">        y (list): Target data.</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">        y_pred (list): Predictions returned by the program (output of `program(x)`).</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">        training (bool): Whether we are training or evaluating the program.</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">        (float | None): The total reward as a scalar, or `None` if no reward results</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">            (which is the case when called by `Program.test_step`).</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="c1"># The default implementation does not use `x` or `training`.</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>    <span class="k">del</span> <span class="n">x</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>    <span class="k">del</span> <span class="n">training</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>    <span class="n">rewards</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_reward</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="k">for</span> <span class="n">y_t</span><span class="p">,</span> <span class="n">y_p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>            <span class="n">reward</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_reward</span><span class="p">(</span><span class="n">y_t</span><span class="p">,</span> <span class="n">y_p</span><span class="p">)</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>            <span class="k">if</span> <span class="n">reward</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>                <span class="n">rewards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reward</span><span class="p">)</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>    <span class="k">for</span> <span class="n">reward</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewards</span><span class="p">:</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="n">rewards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">reward</span><span class="p">))</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rewards</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="n">total_reward</span> <span class="o">=</span> <span class="n">rewards</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">rewards</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="n">total_reward</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(())</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>        <span class="n">total_reward</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rewards</span><span class="p">)</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">total_reward</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="synalinks.src.trainers.trainer.Trainer.evaluate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">evaluate</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Returns the reward value &amp; metrics values for the program in test mode.</p>
<p>Computation is done in batches (see the <code>batch_size</code> arg.)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span> | <span title="generator">generator</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input data. It can be:
- A NumPy array (or array-like), or a list of <code>DataModel</code> arrays
    (in case the model has multiple inputs).
- A list of dict mapping input names to the corresponding <code>DataModel</code>s,
    if the program has named inputs.
- A Python generator function yielding <code>(inputs, targets)</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target data. Like the input data <code>x</code>, it can be either NumPy
array(s) of <code>DataModel</code>(s). If <code>x</code> is a Python generator function,
<code>y</code> should not be specified since targets will be obtained from
<code>x</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>batch_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Integer or <code>None</code>.
Number of samples per batch of computation.
If unspecified, <code>batch_size</code> will default to 32.
Do not specify the <code>batch_size</code> if your input data <code>x</code> is a
Python generator function since they generate batches.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="int">int</span> | <span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>"auto"</code>, 0, 1, or 2. Verbosity mode.
0 = silent, 1 = progress bar, 2 = single line.
<code>"auto"</code> becomes 1 for most cases.
Note that the progress bar is not
particularly useful when logged to a file, so <code>verbose=2</code> is
recommended when not running interactively
(e.g. in a production environment). Defaults to <code>"auto"</code>.</p>
              </div>
            </td>
            <td>
                  <code>&#39;auto&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>steps</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Integer or <code>None</code>.
Total number of steps (batches of samples) to draw before
declaring the evaluation round finished. If <code>steps</code> is <code>None</code>,
it will run until <code>x</code> is exhausted. In the case of an infinitely
repeating dataset, it will run indefinitely.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>callbacks</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of <code>synalinks.callbacks.Callback</code> instances.
List of callbacks to apply during evaluation.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_dict</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, reward and metric results are returned as a
dict, with each key being the name of the metric.
If <code>False</code>, they are returned as a list.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span> | <span title="list">list</span> | <span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scalar test reward
(if the program has a single output and no metrics)
or list of scalars (if the program has multiple outputs
and/or metrics). The attribute <code>program.metrics_names</code> will give you
the display labels for the scalar outputs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>synalinks/src/trainers/trainer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>    <span class="n">batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>    <span class="n">verbose</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>    <span class="n">steps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>    <span class="n">callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>    <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a><span class="p">):</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the reward value &amp; metrics values for the program in test mode.</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a><span class="sd">    Computation is done in batches (see the `batch_size` arg.)</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a><span class="sd">        x (np.ndarray | generator): Input data. It can be:</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a><span class="sd">            - A NumPy array (or array-like), or a list of `DataModel` arrays</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a><span class="sd">                (in case the model has multiple inputs).</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a><span class="sd">            - A list of dict mapping input names to the corresponding `DataModel`s,</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a><span class="sd">                if the program has named inputs.</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a><span class="sd">            - A Python generator function yielding `(inputs, targets)`.</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a><span class="sd">        y (np.ndarray): Target data. Like the input data `x`, it can be either NumPy</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a><span class="sd">            array(s) of `DataModel`(s). If `x` is a Python generator function,</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">            `y` should not be specified since targets will be obtained from</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a><span class="sd">            `x`.</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a><span class="sd">        batch_size (int): Integer or `None`.</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a><span class="sd">            Number of samples per batch of computation.</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a><span class="sd">            If unspecified, `batch_size` will default to 32.</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a><span class="sd">            Do not specify the `batch_size` if your input data `x` is a</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a><span class="sd">            Python generator function since they generate batches.</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="sd">        verbose (int | str): `&quot;auto&quot;`, 0, 1, or 2. Verbosity mode.</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="sd">            0 = silent, 1 = progress bar, 2 = single line.</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">            `&quot;auto&quot;` becomes 1 for most cases.</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a><span class="sd">            Note that the progress bar is not</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a><span class="sd">            particularly useful when logged to a file, so `verbose=2` is</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="sd">            recommended when not running interactively</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a><span class="sd">            (e.g. in a production environment). Defaults to `&quot;auto&quot;`.</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a><span class="sd">        steps (int): Integer or `None`.</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a><span class="sd">            Total number of steps (batches of samples) to draw before</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a><span class="sd">            declaring the evaluation round finished. If `steps` is `None`,</span>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a><span class="sd">            it will run until `x` is exhausted. In the case of an infinitely</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a><span class="sd">            repeating dataset, it will run indefinitely.</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a><span class="sd">        callbacks (list): List of `synalinks.callbacks.Callback` instances.</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a><span class="sd">            List of callbacks to apply during evaluation.</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a><span class="sd">        return_dict (bool): If `True`, reward and metric results are returned as a</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a><span class="sd">            dict, with each key being the name of the metric.</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a><span class="sd">            If `False`, they are returned as a list.</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a><span class="sd">        (float | list | dict): Scalar test reward</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a><span class="sd">            (if the program has a single output and no metrics)</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a><span class="sd">            or list of scalars (if the program has multiple outputs</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a><span class="sd">            and/or metrics). The attribute `program.metrics_names` will give you</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a><span class="sd">            the display labels for the scalar outputs.</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_assert_compile_called</span><span class="p">(</span><span class="s2">&quot;evaluate&quot;</span><span class="p">)</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>    <span class="n">use_cached_eval_dataset</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;_use_cached_eval_dataset&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>    <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Arguments not recognized: </span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>    <span class="c1"># Create an iterator that yields batches of input/target data.</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>    <span class="k">if</span> <span class="n">use_cached_eval_dataset</span><span class="p">:</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>        <span class="n">epoch_iterator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_epoch_iterator</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>        <span class="n">epoch_iterator</span> <span class="o">=</span> <span class="n">EpochIterator</span><span class="p">(</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>            <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>            <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>            <span class="n">steps_per_epoch</span><span class="o">=</span><span class="n">steps</span><span class="p">,</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>            <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>            <span class="n">steps_per_execution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">steps_per_execution</span><span class="p">,</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>        <span class="p">)</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">built</span> <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten_modules</span><span class="p">()):</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>        <span class="c1"># Build the model on one batch of data.</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">epoch_iterator</span><span class="p">:</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>            <span class="n">data_batch</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_auto_build</span><span class="p">(</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>                <span class="n">iterator</span><span class="o">=</span><span class="n">epoch_iterator</span><span class="p">,</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>                <span class="n">data_batch</span><span class="o">=</span><span class="n">data_batch</span><span class="p">,</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>            <span class="p">)</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>            <span class="k">break</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>    <span class="n">epoch_iterator</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>    <span class="c1"># Container that configures and calls callbacks.</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">callbacks</span><span class="p">,</span> <span class="n">callbacks_module</span><span class="o">.</span><span class="n">CallbackList</span><span class="p">):</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>        <span class="n">callbacks</span> <span class="o">=</span> <span class="n">callbacks_module</span><span class="o">.</span><span class="n">CallbackList</span><span class="p">(</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>            <span class="n">callbacks</span><span class="p">,</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>            <span class="n">add_history</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>            <span class="n">add_progbar</span><span class="o">=</span><span class="n">verbose</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>            <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>            <span class="n">steps</span><span class="o">=</span><span class="n">epoch_iterator</span><span class="o">.</span><span class="n">num_batches</span><span class="p">,</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>            <span class="n">program</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a>        <span class="p">)</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">stop_evaluating</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>    <span class="n">callbacks</span><span class="o">.</span><span class="n">on_test_begin</span><span class="p">()</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>    <span class="n">logs</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">reset_metrics</span><span class="p">()</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>    <span class="k">for</span> <span class="n">step</span><span class="p">,</span> <span class="n">iterator</span> <span class="ow">in</span> <span class="n">epoch_iterator</span><span class="p">:</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>        <span class="n">callbacks</span><span class="o">.</span><span class="n">on_test_batch_begin</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">iterator</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>        <span class="n">x_batch</span><span class="p">,</span> <span class="n">y_batch</span> <span class="o">=</span> <span class="n">data_adapter_utils</span><span class="o">.</span><span class="n">unpack_x_y</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>        <span class="n">logs</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_on_batch</span><span class="p">(</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>            <span class="n">x</span><span class="o">=</span><span class="n">x_batch</span><span class="p">,</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>            <span class="n">y</span><span class="o">=</span><span class="n">y_batch</span><span class="p">,</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>            <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>        <span class="p">)</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>        <span class="n">callbacks</span><span class="o">.</span><span class="n">on_test_batch_end</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">logs</span><span class="p">)</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_evaluating</span><span class="p">:</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>            <span class="k">break</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>    <span class="n">logs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_metrics_result_or_logs</span><span class="p">(</span><span class="n">logs</span><span class="p">)</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>    <span class="n">callbacks</span><span class="o">.</span><span class="n">on_test_end</span><span class="p">(</span><span class="n">logs</span><span class="p">)</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a>    <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>        <span class="k">return</span> <span class="n">logs</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten_metrics_in_order</span><span class="p">(</span><span class="n">logs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="synalinks.src.trainers.trainer.Trainer.fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">initial_epoch</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">steps_per_epoch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validation_steps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validation_batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validation_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Trains the program for a fixed number of epochs (dataset iterations).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span> | <span title="generator">generator</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input data. It can be:
- A NumPy array (or array-like), or a list of <code>DataModel</code> arrays
    (in case the model has multiple inputs).
- A list of dict mapping input names to the corresponding <code>DataModel</code>s,
    if the program has named inputs.
- A Python generator function yielding <code>(inputs, targets)</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target data. Like the input data <code>x</code>, it can be either NumPy
array(s) of <code>DataModel</code>(s). If <code>x</code> is a Python generator function,
<code>y</code> should not be specified since targets will be obtained from
<code>x</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>batch_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Integer or <code>None</code>.
Number of samples per batch of computation.
If unspecified, <code>batch_size</code> will default to 32.
Do not specify the <code>batch_size</code> if your input data <code>x</code> is a
Python generator function since they generate batches.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>epochs</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Integer. Number of epochs to train the program.
An epoch is an iteration over the entire <code>x</code> and <code>y</code>
data provided (unless the <code>steps_per_epoch</code> flag is set to
something other than None).
Note that in conjunction with <code>initial_epoch</code>,
<code>epochs</code> is to be understood as "final epoch".
The program is not trained for a number of iterations
given by <code>epochs</code>, but merely until the epoch
of index <code>epochs</code> is reached.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>"auto"</code>, 0, 1, or 2. Verbosity mode.
0 = silent, 1 = progress bar, 2 = one line per epoch.
"auto" becomes 1 for most cases.
Note that the progress bar is not
particularly useful when logged to a file,
so <code>verbose=2</code> is recommended when not running interactively
(e.g., in a production environment). Defaults to <code>"auto"</code>.</p>
              </div>
            </td>
            <td>
                  <code>&#39;auto&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>callbacks</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of <code>synalinks.callbacks.Callback</code> instances.
List of callbacks to apply during training.
See <code>synalinks.callbacks</code>. Note
<code>synalinks.callbacks.ProgbarLogger</code> and
<code>synalinks.callbacks.History</code> callbacks are created
automatically and need not be passed to <code>program.fit()</code>.
<code>synalinks.callbacks.ProgbarLogger</code> is created
or not based on the <code>verbose</code> argument in <code>program.fit()</code>.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>validation_split</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Float between 0 and 1.
Fraction of the training data to be used as validation data.
The program will set apart this fraction of the training data,
will not train on it, and will evaluate the reward and any program
metrics on this data at the end of each epoch. The validation
data is selected from the last samples in the <code>x</code> and <code>y</code> data
provided, before shuffling.
This argument is only supported when <code>x</code> and <code>y</code> are made of
data_models.
If both <code>validation_data</code> and <code>validation_split</code> are provided,
<code>validation_data</code> will override <code>validation_split</code>.</p>
              </div>
            </td>
            <td>
                  <code>0.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>validation_data</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span> | <span title="iterator">iterator</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data on which to evaluate
the reward and any program metrics at the end of each epoch.
The program will not be trained on this data.
<code>validation_data</code> will override <code>validation_split</code>.
It can be:
- A tuple <code>(x_val, y_val)</code> of <code>DataModel</code>s lists.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shuffle</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to shuffle the training data before each
epoch. This argument is ignored when <code>x</code> is a Python generator function.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>initial_epoch</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Integer.
Epoch at which to start training
(useful for resuming a previous training run).</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>steps_per_epoch</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Integer or <code>None</code>.
Total number of steps (batches of samples) before declaring one
epoch finished and starting the next epoch. When training with
input data_models arrays, the default <code>None</code> means that the
value used is the number of samples in your dataset divided by
the batch size, or 1 if that cannot be determined.
If <code>x</code> is a Python generator function, the
epoch will run until the input dataset is exhausted. When
passing an infinitely repeating dataset, you must specify the
<code>steps_per_epoch</code> argument, otherwise the training will run
indefinitely.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>validation_steps</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Integer or <code>None</code>.
Only relevant if <code>validation_data</code> is provided.
Total number of steps (batches of samples) to draw before
stopping when performing validation at the end of every epoch.
If <code>validation_steps</code> is <code>None</code>, validation will run until the
<code>validation_data</code> dataset is exhausted. In the case of an
infinitely repeating dataset, it will run indefinitely. If
<code>validation_steps</code> is specified and only part of the dataset
is consumed, the evaluation will start from the beginning of the
dataset at each epoch. This ensures that the same validation
samples are used every time.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>validation_batch_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Integer or <code>None</code>.
Number of samples per validation batch.
If unspecified, will default to <code>batch_size</code>.
Do not specify the <code>validation_batch_size</code> if your data is a
<code>synalinks.utils.PyDataset</code>, <code>tf.data.Dataset</code>,
<code>torch.utils.data.DataLoader</code> or Python generator function
since they generate batches.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>validation_freq</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Only relevant if validation data is provided.
Specifies how many training epochs to run
before a new validation run is performed,
e.g. <code>validation_freq=2</code> runs validation every 2 epochs.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="History">History</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A <code>History</code> object. Its <code>History.history</code> attribute is
a record of training reward values and metrics values
at successive epochs, as well as validation reward values
and validation metrics values (if applicable).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>synalinks/src/trainers/trainer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>    <span class="n">batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>    <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>    <span class="n">verbose</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>    <span class="n">callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>    <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>    <span class="n">validation_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>    <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>    <span class="n">initial_epoch</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>    <span class="n">steps_per_epoch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>    <span class="n">validation_steps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>    <span class="n">validation_batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>    <span class="n">validation_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a><span class="p">):</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Trains the program for a fixed number of epochs (dataset iterations).</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">        x (np.ndarray | generator): Input data. It can be:</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">            - A NumPy array (or array-like), or a list of `DataModel` arrays</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">                (in case the model has multiple inputs).</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="sd">            - A list of dict mapping input names to the corresponding `DataModel`s,</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="sd">                if the program has named inputs.</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="sd">            - A Python generator function yielding `(inputs, targets)`.</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="sd">        y (np.ndarray): Target data. Like the input data `x`, it can be either NumPy</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a><span class="sd">            array(s) of `DataModel`(s). If `x` is a Python generator function,</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">            `y` should not be specified since targets will be obtained from</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="sd">            `x`.</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a><span class="sd">        batch_size (int): Integer or `None`.</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">            Number of samples per batch of computation.</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a><span class="sd">            If unspecified, `batch_size` will default to 32.</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="sd">            Do not specify the `batch_size` if your input data `x` is a</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a><span class="sd">            Python generator function since they generate batches.</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a><span class="sd">        epochs (int): Integer. Number of epochs to train the program.</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a><span class="sd">            An epoch is an iteration over the entire `x` and `y`</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a><span class="sd">            data provided (unless the `steps_per_epoch` flag is set to</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a><span class="sd">            something other than None).</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a><span class="sd">            Note that in conjunction with `initial_epoch`,</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="sd">            `epochs` is to be understood as &quot;final epoch&quot;.</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="sd">            The program is not trained for a number of iterations</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="sd">            given by `epochs`, but merely until the epoch</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="sd">            of index `epochs` is reached.</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="sd">        verbose (int): `&quot;auto&quot;`, 0, 1, or 2. Verbosity mode.</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">            0 = silent, 1 = progress bar, 2 = one line per epoch.</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a><span class="sd">            &quot;auto&quot; becomes 1 for most cases.</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="sd">            Note that the progress bar is not</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a><span class="sd">            particularly useful when logged to a file,</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="sd">            so `verbose=2` is recommended when not running interactively</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a><span class="sd">            (e.g., in a production environment). Defaults to `&quot;auto&quot;`.</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="sd">        callbacks (list): List of `synalinks.callbacks.Callback` instances.</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="sd">            List of callbacks to apply during training.</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a><span class="sd">            See `synalinks.callbacks`. Note</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="sd">            `synalinks.callbacks.ProgbarLogger` and</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="sd">            `synalinks.callbacks.History` callbacks are created</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">            automatically and need not be passed to `program.fit()`.</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="sd">            `synalinks.callbacks.ProgbarLogger` is created</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">            or not based on the `verbose` argument in `program.fit()`.</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a><span class="sd">        validation_split (float): Float between 0 and 1.</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">            Fraction of the training data to be used as validation data.</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">            The program will set apart this fraction of the training data,</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">            will not train on it, and will evaluate the reward and any program</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">            metrics on this data at the end of each epoch. The validation</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">            data is selected from the last samples in the `x` and `y` data</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">            provided, before shuffling.</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">            This argument is only supported when `x` and `y` are made of</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">            data_models.</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">            If both `validation_data` and `validation_split` are provided,</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">            `validation_data` will override `validation_split`.</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="sd">        validation_data (tuple | iterator): Data on which to evaluate</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">            the reward and any program metrics at the end of each epoch.</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">            The program will not be trained on this data.</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">            `validation_data` will override `validation_split`.</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">            It can be:</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">            - A tuple `(x_val, y_val)` of `DataModel`s lists.</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">        shuffle (bool): Whether to shuffle the training data before each</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">            epoch. This argument is ignored when `x` is a Python generator function.</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">        initial_epoch (int): Integer.</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="sd">            Epoch at which to start training</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">            (useful for resuming a previous training run).</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="sd">        steps_per_epoch (int): Integer or `None`.</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="sd">            Total number of steps (batches of samples) before declaring one</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a><span class="sd">            epoch finished and starting the next epoch. When training with</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a><span class="sd">            input data_models arrays, the default `None` means that the</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a><span class="sd">            value used is the number of samples in your dataset divided by</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="sd">            the batch size, or 1 if that cannot be determined.</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="sd">            If `x` is a Python generator function, the</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a><span class="sd">            epoch will run until the input dataset is exhausted. When</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a><span class="sd">            passing an infinitely repeating dataset, you must specify the</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a><span class="sd">            `steps_per_epoch` argument, otherwise the training will run</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">            indefinitely.</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a><span class="sd">        validation_steps (int): Integer or `None`.</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="sd">            Only relevant if `validation_data` is provided.</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="sd">            Total number of steps (batches of samples) to draw before</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a><span class="sd">            stopping when performing validation at the end of every epoch.</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="sd">            If `validation_steps` is `None`, validation will run until the</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a><span class="sd">            `validation_data` dataset is exhausted. In the case of an</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="sd">            infinitely repeating dataset, it will run indefinitely. If</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a><span class="sd">            `validation_steps` is specified and only part of the dataset</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="sd">            is consumed, the evaluation will start from the beginning of the</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="sd">            dataset at each epoch. This ensures that the same validation</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="sd">            samples are used every time.</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">        validation_batch_size (int): Integer or `None`.</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="sd">            Number of samples per validation batch.</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a><span class="sd">            If unspecified, will default to `batch_size`.</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="sd">            Do not specify the `validation_batch_size` if your data is a</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="sd">            `synalinks.utils.PyDataset`, `tf.data.Dataset`,</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">            `torch.utils.data.DataLoader` or Python generator function</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">            since they generate batches.</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">        validation_freq (int): Only relevant if validation data is provided.</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="sd">            Specifies how many training epochs to run</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">            before a new validation run is performed,</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="sd">            e.g. `validation_freq=2` runs validation every 2 epochs.</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">        (History): A `History` object. Its `History.history` attribute is</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">            a record of training reward values and metrics values</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">            at successive epochs, as well as validation reward values</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a><span class="sd">            and validation metrics values (if applicable).</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_assert_compile_called</span><span class="p">(</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>    <span class="c1"># TODO: respect compiled trainable state</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_eval_epoch_iterator</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>    <span class="k">if</span> <span class="n">validation_split</span> <span class="ow">and</span> <span class="n">validation_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>        <span class="c1"># Create the validation data using the training data. Only supported</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>        <span class="c1"># for numpy arrays.</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>        <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">validation_data</span> <span class="o">=</span> <span class="n">array_slicing</span><span class="o">.</span><span class="n">train_validation_split</span><span class="p">(</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>            <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">validation_split</span><span class="o">=</span><span class="n">validation_split</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>        <span class="p">)</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>    <span class="k">if</span> <span class="n">validation_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>        <span class="p">(</span><span class="n">val_x</span><span class="p">,</span> <span class="n">val_y</span><span class="p">)</span> <span class="o">=</span> <span class="n">data_adapter_utils</span><span class="o">.</span><span class="n">unpack_x_y</span><span class="p">(</span><span class="n">validation_data</span><span class="p">)</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>    <span class="c1"># Create an iterator that yields batches of input/target data.</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>    <span class="n">epoch_iterator</span> <span class="o">=</span> <span class="n">EpochIterator</span><span class="p">(</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>        <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>        <span class="n">steps_per_epoch</span><span class="o">=</span><span class="n">steps_per_epoch</span><span class="p">,</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>        <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>        <span class="n">steps_per_execution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">steps_per_execution</span><span class="p">,</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>    <span class="p">)</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="n">built</span> <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten_modules</span><span class="p">()):</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>        <span class="c1"># Build the model on one batch of data.</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">epoch_iterator</span><span class="p">:</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>            <span class="n">data_batch</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_auto_build</span><span class="p">(</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>                <span class="n">iterator</span><span class="o">=</span><span class="n">epoch_iterator</span><span class="p">,</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>                <span class="n">data_batch</span><span class="o">=</span><span class="n">data_batch</span><span class="p">,</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>            <span class="p">)</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>            <span class="k">break</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>    <span class="n">epoch_iterator</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>    <span class="c1"># Container that configures and calls callbacks.</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">callbacks</span><span class="p">,</span> <span class="n">callbacks_module</span><span class="o">.</span><span class="n">CallbackList</span><span class="p">):</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>        <span class="n">callbacks</span> <span class="o">=</span> <span class="n">callbacks_module</span><span class="o">.</span><span class="n">CallbackList</span><span class="p">(</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>            <span class="n">callbacks</span><span class="p">,</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>            <span class="n">add_history</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>            <span class="n">add_progbar</span><span class="o">=</span><span class="n">verbose</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>            <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>            <span class="n">steps</span><span class="o">=</span><span class="n">steps_per_epoch</span><span class="p">,</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>            <span class="n">program</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>        <span class="p">)</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">stop_training</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>    <span class="n">callbacks</span><span class="o">.</span><span class="n">on_train_begin</span><span class="p">()</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>    <span class="n">training_logs</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>    <span class="n">logs</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>    <span class="n">initial_epoch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initial_epoch</span> <span class="ow">or</span> <span class="n">initial_epoch</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">initial_epoch</span><span class="p">,</span> <span class="n">epochs</span><span class="p">):</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">reset_metrics</span><span class="p">()</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>        <span class="n">callbacks</span><span class="o">.</span><span class="n">on_epoch_begin</span><span class="p">(</span><span class="n">epoch</span><span class="p">)</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>        <span class="k">with</span> <span class="n">epoch_iterator</span><span class="o">.</span><span class="n">catch_stop_iteration</span><span class="p">():</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>            <span class="k">for</span> <span class="n">step</span><span class="p">,</span> <span class="n">iterator</span> <span class="ow">in</span> <span class="n">epoch_iterator</span><span class="p">:</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">iterator</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>                <span class="n">x_batch</span><span class="p">,</span> <span class="n">y_batch</span> <span class="o">=</span> <span class="n">data_adapter_utils</span><span class="o">.</span><span class="n">unpack_x_y</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>                <span class="n">callbacks</span><span class="o">.</span><span class="n">on_train_batch_begin</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>                <span class="n">logs</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_on_batch</span><span class="p">(</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>                    <span class="n">x</span><span class="o">=</span><span class="n">x_batch</span><span class="p">,</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>                    <span class="n">y</span><span class="o">=</span><span class="n">y_batch</span><span class="p">,</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>                    <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>                <span class="p">)</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>                <span class="n">callbacks</span><span class="o">.</span><span class="n">on_train_batch_end</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">logs</span><span class="p">)</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_training</span><span class="p">:</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>                    <span class="k">break</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>        <span class="c1"># Override with model metrics instead of last step logs if needed.</span>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>        <span class="n">epoch_logs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_metrics_result_or_logs</span><span class="p">(</span><span class="n">logs</span><span class="p">))</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a>        <span class="c1"># Run validation.</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a>        <span class="k">if</span> <span class="n">validation_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_eval</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">validation_freq</span><span class="p">):</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a>            <span class="c1"># Create EpochIterator for evaluation and cache it.</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_eval_epoch_iterator&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_eval_epoch_iterator</span> <span class="o">=</span> <span class="n">EpochIterator</span><span class="p">(</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a>                    <span class="n">x</span><span class="o">=</span><span class="n">val_x</span><span class="p">,</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>                    <span class="n">y</span><span class="o">=</span><span class="n">val_y</span><span class="p">,</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>                    <span class="n">batch_size</span><span class="o">=</span><span class="n">validation_batch_size</span> <span class="ow">or</span> <span class="n">batch_size</span><span class="p">,</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>                    <span class="n">steps_per_execution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">steps_per_execution</span><span class="p">,</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>                    <span class="n">steps_per_epoch</span><span class="o">=</span><span class="n">validation_steps</span><span class="p">,</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>                    <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>                <span class="p">)</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>            <span class="n">val_logs</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>                <span class="n">x</span><span class="o">=</span><span class="n">val_x</span><span class="p">,</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>                <span class="n">y</span><span class="o">=</span><span class="n">val_y</span><span class="p">,</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>                <span class="n">batch_size</span><span class="o">=</span><span class="n">validation_batch_size</span> <span class="ow">or</span> <span class="n">batch_size</span><span class="p">,</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>                <span class="n">steps</span><span class="o">=</span><span class="n">validation_steps</span><span class="p">,</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>                <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">,</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>                <span class="n">_use_cached_eval_dataset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>            <span class="p">)</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>            <span class="n">val_logs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;val_&quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">:</span> <span class="n">val</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">val_logs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>            <span class="n">epoch_logs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">val_logs</span><span class="p">)</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>        <span class="n">callbacks</span><span class="o">.</span><span class="n">on_epoch_end</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">epoch_logs</span><span class="p">)</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a>        <span class="n">training_logs</span> <span class="o">=</span> <span class="n">epoch_logs</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_training</span><span class="p">:</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a>            <span class="k">break</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">optimizers_module</span><span class="o">.</span><span class="n">Optimizer</span><span class="p">)</span> <span class="ow">and</span> <span class="n">epochs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">finalize_variable_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainable_variables</span><span class="p">)</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>    <span class="c1"># If _eval_epoch_iterator exists, delete it after all epochs are done.</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_eval_epoch_iterator&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_epoch_iterator</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>    <span class="n">callbacks</span><span class="o">.</span><span class="n">on_train_end</span><span class="p">(</span><span class="n">logs</span><span class="o">=</span><span class="n">training_logs</span><span class="p">)</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="synalinks.src.trainers.trainer.Trainer.get_compile_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_compile_config</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Returns a serialized config with information for compiling the program.</p>
<p>This method returns a config dictionary containing all the information
(optimizer, reward, metrics, etc.) with which the program was compiled.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dict containing information for compiling the program.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>synalinks/src/trainers/trainer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-860" name="__codelineno-0-860"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_compile_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a serialized config with information for compiling the program.</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a><span class="sd">    This method returns a config dictionary containing all the information</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a><span class="sd">    (optimizer, reward, metrics, etc.) with which the program was compiled.</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a><span class="sd">        (dict): A dict containing information for compiling the program.</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiled</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_compile_config&quot;</span><span class="p">):</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compile_config</span><span class="o">.</span><span class="n">serialize</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="synalinks.src.trainers.trainer.Trainer.get_metrics_result" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_metrics_result</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Returns the program's metrics values as a dict.</p>
<p>If any of the metric result is a dict (containing multiple metrics),
each of them gets added to the top level returned dict of this method.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A <code>dict</code> containing values of the metrics listed in <code>self.metrics</code>.
Example: <code>{'reward': 0.2, 'accuracy': 0.7}</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>synalinks/src/trainers/trainer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_metrics_result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the program&#39;s metrics values as a dict.</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">    If any of the metric result is a dict (containing multiple metrics),</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">    each of them gets added to the top level returned dict of this method.</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a><span class="sd">        (dict): A `dict` containing values of the metrics listed in `self.metrics`.</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a><span class="sd">            Example: `{&#39;reward&#39;: 0.2, &#39;accuracy&#39;: 0.7}`.</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>    <span class="n">return_metrics</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>    <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">:</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>            <span class="n">return_metrics</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>            <span class="n">return_metrics</span><span class="p">[</span><span class="n">metric</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>    <span class="k">return</span> <span class="n">python_utils</span><span class="o">.</span><span class="n">pythonify_logs</span><span class="p">(</span><span class="n">return_metrics</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="synalinks.src.trainers.trainer.Trainer.predict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Generates output predictions for the input samples.</p>
<p>Computation is done in batches. This method is designed for batch
processing of large numbers of inputs. It is not intended for use inside
of loops that iterate over your data and process small numbers of inputs
at a time.</p>
<p>For small numbers of inputs that fit in one batch,
directly use <code>__call__()</code> for faster execution, e.g.,
<code>program(x)</code>, or <code>program(x, training=False)</code> if you have modules
that behave differently during inference.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span> | <span title="generator">generator</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input data. It can be:
- A NumPy array (or array-like), or a list of <code>DataModel</code> arrays
    (in case the model has multiple inputs).
- A list of dict mapping input names to the corresponding <code>DataModel</code>s,
    if the program has named inputs.
- A Python generator function yielding <code>(inputs, targets)</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>batch_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Integer or <code>None</code>.
Number of samples per batch of computation.
If unspecified, <code>batch_size</code> will default to 32.
Do not specify the <code>batch_size</code> if your input data <code>x</code> is a
<code>synalinks.utils.PyDataset</code>, <code>tf.data.Dataset</code>,
<code>torch.utils.data.DataLoader</code> or Python generator function
since they generate batches.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>"auto"</code>, 0, 1, or 2. Verbosity mode.
0 = silent, 1 = progress bar, 2 = single line.
<code>"auto"</code> becomes 1 for most cases. Note that the progress bar
is not particularly useful when logged to a file,
so <code>verbose=2</code> is recommended when not running interactively
(e.g. in a production environment). Defaults to <code>"auto"</code>.</p>
              </div>
            </td>
            <td>
                  <code>&#39;auto&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>steps</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total number of steps (batches of samples) to draw before
declaring the prediction round finished. If <code>steps</code> is <code>None</code>,
it will run until <code>x</code> is exhausted. In the case of an infinitely
repeating dataset, it will run indefinitely.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>callbacks</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of <code>synalinks.callbacks.Callback</code> instances.
List of callbacks to apply during prediction.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>JsonDataModel</code> array(s) of predictions.
If the pipeline failed, a None is added to the predictions.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>synalinks/src/trainers/trainer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-677" name="__codelineno-0-677"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="kc">None</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a><span class="p">):</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates output predictions for the input samples.</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a><span class="sd">    Computation is done in batches. This method is designed for batch</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a><span class="sd">    processing of large numbers of inputs. It is not intended for use inside</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="sd">    of loops that iterate over your data and process small numbers of inputs</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="sd">    at a time.</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a><span class="sd">    For small numbers of inputs that fit in one batch,</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a><span class="sd">    directly use `__call__()` for faster execution, e.g.,</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a><span class="sd">    `program(x)`, or `program(x, training=False)` if you have modules</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a><span class="sd">    that behave differently during inference.</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a><span class="sd">        x (np.ndarray | generator): Input data. It can be:</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a><span class="sd">            - A NumPy array (or array-like), or a list of `DataModel` arrays</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a><span class="sd">                (in case the model has multiple inputs).</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a><span class="sd">            - A list of dict mapping input names to the corresponding `DataModel`s,</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a><span class="sd">                if the program has named inputs.</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a><span class="sd">            - A Python generator function yielding `(inputs, targets)`.</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a><span class="sd">        batch_size (int): Integer or `None`.</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a><span class="sd">            Number of samples per batch of computation.</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a><span class="sd">            If unspecified, `batch_size` will default to 32.</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a><span class="sd">            Do not specify the `batch_size` if your input data `x` is a</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a><span class="sd">            `synalinks.utils.PyDataset`, `tf.data.Dataset`,</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a><span class="sd">            `torch.utils.data.DataLoader` or Python generator function</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a><span class="sd">            since they generate batches.</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a><span class="sd">        verbose (int): `&quot;auto&quot;`, 0, 1, or 2. Verbosity mode.</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a><span class="sd">            0 = silent, 1 = progress bar, 2 = single line.</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a><span class="sd">            `&quot;auto&quot;` becomes 1 for most cases. Note that the progress bar</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a><span class="sd">            is not particularly useful when logged to a file,</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a><span class="sd">            so `verbose=2` is recommended when not running interactively</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a><span class="sd">            (e.g. in a production environment). Defaults to `&quot;auto&quot;`.</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a><span class="sd">        steps (int): Total number of steps (batches of samples) to draw before</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a><span class="sd">            declaring the prediction round finished. If `steps` is `None`,</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a><span class="sd">            it will run until `x` is exhausted. In the case of an infinitely</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a><span class="sd">            repeating dataset, it will run indefinitely.</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a><span class="sd">        callbacks (list): List of `synalinks.callbacks.Callback` instances.</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a><span class="sd">            List of callbacks to apply during prediction.</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a><span class="sd">        (list): `JsonDataModel` array(s) of predictions.</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a><span class="sd">            If the pipeline failed, a None is added to the predictions.</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>    <span class="c1"># Create an iterator that yields batches of input data.</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>    <span class="n">epoch_iterator</span> <span class="o">=</span> <span class="n">EpochIterator</span><span class="p">(</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>        <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>        <span class="n">steps_per_epoch</span><span class="o">=</span><span class="n">steps</span><span class="p">,</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>        <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>        <span class="n">steps_per_execution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">steps_per_execution</span><span class="p">,</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>    <span class="p">)</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>    <span class="c1"># Container that configures and calls callbacks.</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">callbacks</span><span class="p">,</span> <span class="n">callbacks_module</span><span class="o">.</span><span class="n">CallbackList</span><span class="p">):</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>        <span class="n">callbacks</span> <span class="o">=</span> <span class="n">callbacks_module</span><span class="o">.</span><span class="n">CallbackList</span><span class="p">(</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>            <span class="n">callbacks</span><span class="p">,</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>            <span class="n">add_history</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>            <span class="n">add_progbar</span><span class="o">=</span><span class="n">verbose</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>            <span class="n">epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>            <span class="n">steps</span><span class="o">=</span><span class="n">epoch_iterator</span><span class="o">.</span><span class="n">num_batches</span><span class="p">,</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>        <span class="p">)</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">stop_predicting</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>    <span class="n">callbacks</span><span class="o">.</span><span class="n">on_test_begin</span><span class="p">()</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>    <span class="n">outputs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>    <span class="k">for</span> <span class="n">step</span><span class="p">,</span> <span class="n">iterator</span> <span class="ow">in</span> <span class="n">epoch_iterator</span><span class="p">:</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>        <span class="n">callbacks</span><span class="o">.</span><span class="n">on_predict_batch_begin</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">iterator</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>        <span class="n">x_batch</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">data_adapter_utils</span><span class="o">.</span><span class="n">unpack_x_y</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>        <span class="n">batch_outputs</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_on_batch</span><span class="p">(</span><span class="n">x_batch</span><span class="p">)</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>        <span class="n">outputs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">batch_outputs</span><span class="p">)</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>        <span class="n">callbacks</span><span class="o">.</span><span class="n">on_predict_batch_end</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;outputs&quot;</span><span class="p">:</span> <span class="n">batch_outputs</span><span class="p">})</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_predicting</span><span class="p">:</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>            <span class="k">break</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>    <span class="n">callbacks</span><span class="o">.</span><span class="n">on_predict_end</span><span class="p">()</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="synalinks.src.trainers.trainer.Trainer.predict_on_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">predict_on_batch</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Returns predictions for a single batch of samples.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input data. Must be array-like.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>training</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Boolean. True if training.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list(s) of JsonDataModel predictions.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>synalinks/src/trainers/trainer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-844" name="__codelineno-0-844"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">predict_on_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns predictions for a single batch of samples.</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a><span class="sd">        x (np.ndarray): Input data. Must be array-like.</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a><span class="sd">        training (bool): Boolean. True if training.</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a><span class="sd">        (list): list(s) of JsonDataModel predictions.</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>    <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>    <span class="k">for</span> <span class="n">inputs</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>        <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="n">training</span><span class="p">))</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>    <span class="n">y_pred</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>    <span class="k">return</span> <span class="n">y_pred</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="synalinks.src.trainers.trainer.Trainer.test_on_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">test_on_batch</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Test the program on a single batch of samples.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input data. Must be array-like.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target data. Must be array-like.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_dict</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, reward and metric results are returned as a
dict, with each key being the name of the metric. If <code>False</code>,
they are returned as a list.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span> | <span title="list">list</span> | <span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A scalar reward value
(when no metrics and <code>return_dict=False</code>), a list of reward
and metric values (if there are metrics and <code>return_dict=False</code>),
or a dict of metric and reward values (if <code>return_dict=True</code>).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>synalinks/src/trainers/trainer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span>
<span class="normal"><a href="#__codelineno-0-808">808</a></span>
<span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-806" name="__codelineno-0-806"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_on_batch</span><span class="p">(</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>    <span class="n">x</span><span class="p">,</span>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>    <span class="n">return_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a><span class="p">):</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Test the program on a single batch of samples.</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a><span class="sd">        x (np.ndarray): Input data. Must be array-like.</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a><span class="sd">        y (np.ndarray): Target data. Must be array-like.</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a><span class="sd">        return_dict (bool): If `True`, reward and metric results are returned as a</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a><span class="sd">            dict, with each key being the name of the metric. If `False`,</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a><span class="sd">            they are returned as a list.</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a><span class="sd">        (float | list | dict): A scalar reward value</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a><span class="sd">            (when no metrics and `return_dict=False`), a list of reward</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a><span class="sd">            and metric values (if there are metrics and `return_dict=False`),</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a><span class="sd">            or a dict of metric and reward values (if `return_dict=True`).</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a>    <span class="n">y_pred</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_on_batch</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>    <span class="n">reward</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_reward</span><span class="p">(</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>        <span class="n">y_pred</span><span class="o">=</span><span class="n">y_pred</span><span class="p">,</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>        <span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>    <span class="p">)</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reward_tracker</span><span class="o">.</span><span class="n">update_state</span><span class="p">(</span><span class="n">reward</span><span class="p">)</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>    <span class="n">metrics</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_metrics</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>    <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>        <span class="k">return</span> <span class="n">metrics</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten_metrics_in_order</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="synalinks.src.trainers.trainer.Trainer.train_on_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_on_batch</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Runs a single backpropagation/optimization update on a single batch of data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input data. Must be array-like.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target data. Must be array-like.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_dict</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>True</code>, reward and metric results are returned as a
dict, with each key being the name of the metric. If <code>False</code>,
they are returned as a list.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="float">float</span> | <span title="list">list</span> | <span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A scalar reward value
(when no metrics and <code>return_dict=False</code>), a list of reward
and metric values (if there are metrics and <code>return_dict=False</code>),
or a dict of metric and reward values (if <code>return_dict=True</code>).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>synalinks/src/trainers/trainer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-759" name="__codelineno-0-759"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">train_on_batch</span><span class="p">(</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>    <span class="n">x</span><span class="p">,</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>    <span class="n">return_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a><span class="p">):</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Runs a single backpropagation/optimization update on a single batch of data.</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a><span class="sd">        x (np.ndarray): Input data. Must be array-like.</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a><span class="sd">        y (np.ndarray): Target data. Must be array-like.</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a><span class="sd">        return_dict (bool): If `True`, reward and metric results are returned as a</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a><span class="sd">            dict, with each key being the name of the metric. If `False`,</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a><span class="sd">            they are returned as a list.</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a><span class="sd">        (float | list | dict): A scalar reward value</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a><span class="sd">            (when no metrics and `return_dict=False`), a list of reward</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a><span class="sd">            and metric values (if there are metrics and `return_dict=False`),</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a><span class="sd">            or a dict of metric and reward values (if `return_dict=True`).</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>    <span class="n">y_pred</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_on_batch</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>    <span class="n">reward</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_reward</span><span class="p">(</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>        <span class="n">y_pred</span><span class="o">=</span><span class="n">y_pred</span><span class="p">,</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>        <span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>    <span class="p">)</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reward_tracker</span><span class="o">.</span><span class="n">update_state</span><span class="p">(</span><span class="n">reward</span><span class="p">)</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>    <span class="c1"># Perform training/optimization</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainable_variables</span><span class="p">:</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">apply_optimization</span><span class="p">(</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">trainable_variables</span><span class="p">,</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>            <span class="n">reward</span><span class="o">=</span><span class="n">reward</span><span class="p">,</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>        <span class="p">)</span>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;The program does not have any trainable variables.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>    <span class="n">metrics</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_metrics</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>    <span class="k">if</span> <span class="n">return_dict</span><span class="p">:</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>        <span class="k">return</span> <span class="n">metrics</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten_metrics_in_order</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>